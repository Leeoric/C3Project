function $() { var f = null; if (typeof arguments[0] != "string") { if (!arguments[0]) { return null } f = arguments[0]; if (!f.version) { $._Method.Element.apply(f); if ($._appendMethod) { $._appendMethod.apply(f) } } return f } var o = arguments[0].trim(); if (o.indexOf(" ") == -1 && o.indexOf(",") == -1 && o.indexOf(".") == -1 && o.indexOf("[") == -1 && o.indexOf(">") == -1) { f = document.getElementById(o.replace("#", "")); if (!f) { return null } if (!f.version) { $._Method.Element.apply(f); if ($._appendMethod) { $._appendMethod.apply(f) } } return f } var t = o.replace(/(^,*)|(,*$)/g, "").split(","); var k = []; for (var n = 0, l; l = t[n]; n++) { var e = l = t[n].trim().replace(/ +/g, " ").split(" "); for (var g = 0, d; d = e[g]; g++) { if (d.indexOf("#") == 0) { if (!document.getElementById(d.substring(1))) { return null } f = $(d.substring(1)); continue } var j = []; var c = []; if (d.indexOf(".") != -1) { var s = d.replace(/\[.*?\]/gi, function (a) { j.push(a.replace(/\[|\]/g, "")); return "" }); var r = s.split(".")[0]; var m = s.split(".")[1]; if (f == null) { c = $._find(r, m, arguments[1] || document) } else { if (f instanceof Array) { var h = []; f.each(function (a) { $._find(r, m, a).each(function () { h.push(arguments[0]) }) }); c = h } else { c = $._find(r, m, f) } } f = $._attributeSelector(j, c); continue } else { var r = d.replace(/\[.*?\]/gi, function (a) { j.push(a.replace(/\[|\]/g, "")); return "" }); if (f == null) { c = $A((arguments[1] || document).getElementsByTagName(r)).each(function (a) { $(a) }) } else { if (f instanceof Array) { var h = []; f.each(function (a) { $A(a.getElementsByTagName(r)).each(function (b) { h.push($(b)) }) }); c = h } else { c = $A(f.getElementsByTagName(r)).each(function (a) { $(a) }) } } f = $._attributeSelector(j, c) } } if (f.constructor == Array) { f.each(function (a) { k.push(a) }) } else { k.push(f) } f = null } return k } $.Version = "1.1"; $._find = function (b, g, e) { var a = e.getElementsByTagName(b || "*"); var f = []; for (var d = 0, c; c = a[d]; d++) { if (c.className.hasSubString(g, " ")) { f.push($(c)) } } return f }; $._attributeSelector = function (e, b) { for (var c = 0; c < e.length; c++) { var d = []; var a = e[c].split(/=|!=/g); if (a.length == 1) { b.each(function (f) { if (f.getAttribute(a[0].trim())) { d.push(f) } }) } else { if (a.length > 1) { b.each(function (f) { if (e[c].indexOf("!=") != -1) { if (f.getAttribute(a[0].trim()) != a[1].trim()) { d.push(f) } } else { if (f.getAttribute(a[0].trim()) == a[1].trim()) { d.push(f) } } }) } } b.length = 0; b = d } return b }; function NameSpace() { } function StringBuffer() { this.data = [] } $._Method = { Element: function () { this.version = $.Version; this.hide = function () { this.style.display = "none"; return this }; this.show = function () { this.style.display = ""; return this }; this.getStyle = function (b) { var c = this.style[b == "float" ? ($.Browse.isIE() ? "styleFloat" : "cssFloat") : b.camelize()]; if (!c) { if (this.currentStyle) { c = this.currentStyle[b.camelize()] } else { if (document.defaultView && document.defaultView.getComputedStyle) { var a = document.defaultView.getComputedStyle(this, null); c = a ? a.getPropertyValue(b) : null } } } return c }; this.setStyle = function (f) { var a = f.split(";"); for (var e = 0, c; c = a[e]; e++) { var b = c.split(/:(?!\/\/)/g); var d = b[0].trim(); d = d == "float" ? ($.Browse.isIE() ? "styleFloat" : "cssFloat") : d.camelize(); this.style[d] = b[1].trim() } return this }; this.toggle = function () { this.getStyle("display") == "none" ? this.show() : this.hide(); return this }; this.hasClassName = function (a) { return this.className.hasSubString(a, " ") }; this.addClassName = function (a) { if (!this.hasClassName(a)) { this.className += " " + a } return this }; this.removeClassName = function (a) { if (this.hasClassName(a)) { this.className = (" " + this.className + " ").replace(" " + a + " ", " ").trim(); return this } }; this.toggleClassName = function (a) { if (this.hasClassName(a)) { this.removeClassName(a) } else { this.addClassName(a) } return this }; this.getElementsByClassName = function (a) { return this.getElementsByAttribute("className", a) }; this.getElementsByAttribute = function (g, d) { var c = this.getElementsByTagName("*"); var a = []; for (var f = 0, e; e = c[f]; f++) { var b = e[g] || e.getAttribute(g); if (b == d) { a.push(e) } else { if (d == "*" && b != null) { a.push(e) } } } return a }; this.subTag = function () { return $A(this.getElementsByTagName(arguments[0])).each(function (a) { $(a) }) }; this.parentIndex = function (b) { if (this == b) { return 0 } for (var a = 1, c = this; c = c.parentNode; a++) { if (c == b) { return a } if (c == document.documentElement) { return -1 } } }; this.remove = function () { if (arguments[0]) { var b = $(this.parentNode).subElem(arguments[0]); for (var a = 0; a < b.length; a++) { b[a].parentNode.removeChild(b[a]) } } else { return this.parentNode.removeChild(this) } }; this.nextElement = function () { var b = this; for (var a = 0, b; b = b.nextSibling; a++) { if (b.nodeType == 1) { return $(b) } } return null }; this.previousElement = function () { var b = this; for (var a = 0, b; b = b.previousSibling; a++) { if (b.nodeType == 1) { return $(b) } } return null }; this.subElem = function (a) { return $(a, this) }; this.findParent = function (e) { for (var d = 0, f = this; f = f.parentNode; d++) { if (f == document.documentElement || f == document.body) { break } var c = 0; for (var b in e) { var a = f.key || f[b] || f.getAttribute(b); if (a != e[b]) { c++; break } } if (c == 0) { return f } } return null }; this.insertHtml = function (b, c) { b = b.toLowerCase(); if (this.insertAdjacentHTML) { switch (b) { case "beforebegin": this.insertAdjacentHTML("BeforeBegin", c); return this.previousSibling; case "afterbegin": this.insertAdjacentHTML("AfterBegin", c); return this.firstChild; case "beforeend": this.insertAdjacentHTML("BeforeEnd", c); return this.lastChild; case "afterend": this.insertAdjacentHTML("AfterEnd", c); return this.nextSibling } throw 'Illegal insertion point -> "' + b + '"' } var a = this.ownerDocument.createRange(); var d; switch (b) { case "beforebegin": a.setStartBefore(this); d = a.createContextualFragment(c); this.parentNode.insertBefore(d, this); return this.previousSibling; case "afterbegin": if (this.firstChild) { a.setStartBefore(this.firstChild); d = a.createContextualFragment(c); this.insertBefore(d, this.firstChild); return this.firstChild } else { this.innerHTML = c; return this.firstChild } case "beforeend": if (this.lastChild) { a.setStartAfter(this.lastChild); d = a.createContextualFragment(c); this.appendChild(d); return this.lastChild } else { this.innerHTML = c; return this.lastChild } case "afterend": a.setStartAfter(this); d = a.createContextualFragment(c); this.parentNode.insertBefore(d, this.nextSibling); return this.nextSibling } throw 'Illegal insertion point -> "' + b + '"' }; this.addOptions = function (b) { this.length = 0; if (b.blank) { this.options.add(new Option(b.blank.text, b.blank.value)) } if (b.data) { var d = "text", c = "value"; if (b.index) { d = b.index.text; c = b.index.value } for (var a = 0; a < b.data.length; a++) { this.options.add(new Option(b.data[a][d], b.data[a][c])) } } } }, Array: function () { this.indexOf = function () { for (i = 0; i < this.length; i++) { if (this[i] == arguments[0]) { return i } } return -1 }; this.each = function (c) { for (var b = 0, a = this.length; b < a; b++) { c(this[b], b) } return this }; this.bind = function (c) { for (var b = 0, a = this.length; b < a; b++) { c.call(this[b], b) } }; this.sortByValue = function (e) { for (var d = this.length; d > 0; d >>= 1) { for (var c = 0; c < d; c++) { for (var a = d + c; a < this.length; a = a + d) { var b = this[a]; var f = a; while (f >= d && e ? this[f - 1] < b : this[f - d] > b) { this[f] = this[f - d]; f = f - d } this[f] = b } } } return this }; this.remove = function () { for (var b = 0; b < this.length; b++) { if (arguments[0] == this[b]) { break } } if (b == this.length) { return } for (var a = b; a < this.length - 1; a++) { this[a] = this[a + 1] } this.length-- }; this.strip = function () { if (this.length < 2) { return [this[0]] || [] } var a = []; for (var c = 0; c < this.length; c++) { a.push(this.splice(c--, 1)); for (var b = 0; b < this.length; b++) { if (this[b] == a[a.length - 1]) { this.splice(b--, 1) } } } return a } }, String: function () { this.trim = function () { var _argument = arguments[0] == undefined ? " " : arguments[0]; if (typeof (_argument) == "string") { return this.replace(_argument == " " ? /(^\s*)|(\s*$)/g : new RegExp("(^" + _argument + "*)|(" + _argument + "*$)", "g"), "") } else { if (typeof (_argument) == "object") { return this.replace(_argument, "") } else { if (typeof (_argument) == "number" && arguments.length >= 1) { return arguments.length == 1 ? this.substring(arguments[0]) : this.substring(arguments[0], this.length - arguments[1]) } } } }; this.innerText = function () { return this.replace(/<\/?[^>]+>/gi, "") }; this.toInt = function () { return this.replace(/\D/g, "") * 1 }; this.hasSubString = function (s, f) { if (!f) { f = "" } return (f + this + f).indexOf(f + s + f) == -1 ? false : true }; this.hasSubStrInArr = function () { for (var i = 0; i < arguments[0].length; i++) { if (this.hasSubString(arguments[0][i])) { return true } } return false }; this.toXMLString = function () { var arr = this.split("&"); var str = new StringBuffer(); for (var i = 0, len = arr.length; i < len; i++) { var item = arr[i].split("="); str.append("<" + item[0] + "><![CDATA[" + item[1] + "]]></" + item[0] + ">") } var rootStr = arguments[0] ? arguments[0] : "root"; return "<" + rootStr + ">" + str.toString() + "</" + rootStr + ">" }; this.format = function () { var p = arguments; return this.replace(/(\{\d+\})/g, function () { return p[arguments[0].replace(/\D/g, "")] }) }; this.toJSON = function () { if (this.trim().length == 0) { return "" } else { try { return eval("(" + this.trim() + ")") } catch (e) { throw new Error("this string build JSON error!") } } }; this.toJosnString = function () { if (this.trim().length == 0) { return "" } else { return this.replace(/\\/, "\\\\").replaceAll('"', '\\"') } }; this.uniq = function () { var arr = this.split(""); var obj = {}; for (var i = 0, j; j = arr[i]; i++) { obj[j] = i } var s = []; for (var key in obj) { s[obj[key]] = key } return s.join("") }; this.replaceAll = function (AFindText, ARepText) { raRegExp = new RegExp(AFindText, "g"); return this.replace(raRegExp, ARepText) }; this.codeLength = function () { var len = 0; if (this == null || this.length == 0) { return 0 } var str = this.replace(/(^\s*)|(\s*$)/g, ""); for (i = 0; i < str.length; i++) { if (str.charCodeAt(i) > 0 && str.charCodeAt(i) < 128) { len++ } else { len += 2 } } return len } }, Function: function () { this.bind = function () { var a = this, c = $A(arguments), b = c.shift(); return function () { return a.apply(b, c.concat($A(arguments))) } } }, StringBuffer: function () { this.append = function () { this.data.push(arguments[0]); return this }; this.toString = function () { return this.data.join(arguments[0] || "") }; this.length = function () { return this.data.length }; this.clear = function () { this.data.length = 0; return this } }, NameSpace: function () { this.copyChild = function (b) { for (var a in b) { this[a] = b[a] } return this } } }; $._Method.Array.apply(Array.prototype); $._Method.String.apply(String.prototype); $._Method.Function.apply(Function.prototype); $._Method.StringBuffer.apply(StringBuffer.prototype); $._Method.NameSpace.apply(NameSpace.prototype); $.Browse = { isIE: function () { return navigator.userAgent.hasSubString("MSIE") }, isFF: function () { return navigator.userAgent.hasSubString("Firefox") }, isOpera: function () { return navigator.userAgent.hasSubString("Opera") }, isSafari: function () { return navigator.userAgent.hasSubString("Safari") }, isGecko: function () { return navigator.userAgent.hasSubString("Gecko") }, IEVer: function () { return $.Browse.isIE() ? parseInt(navigator.userAgent.split(";")[1].trim().split(" ")[1]) : 0 } }; $(document); var Ajax = { xmlhttp: function () { var b = null; try { b = new ActiveXObject("MSXML2.XMLHTTP") } catch (a) { try { b = new ActiveXObject("Microsoft.XMLHTTP") } catch (a) { b = new XMLHttpRequest() } } return Ajax.xmlObjCache = b }, xmlObjCache: null }; Ajax.Request = function (d) { var a = { url: location.href, async: true, type: "GET", data: null, contentType: "application/x-www-form-urlencoded" }; for (var c in d) { a[c] = d[c] } a.type = a.type.toUpperCase(); var b = Ajax.xmlhttp(); if (a.type == "GET") { a.url += (a.url.match(/\?/) ? "&" : "?") + a.data } b.open(a.type, a.url, a.async); b.onreadystatechange = Ajax.onStateChange.bind(b, a); if (a.type == "POST") { b.setRequestHeader("Content-Type", a.contentType) } b.send(a.type == "POST" ? (a.postBody ? a.postBody : a.data) : null); return b }; Ajax.onStateChange = function (a) { if (this.readyState == 4) { if (this.status == 200) { a.onComplete ? a.onComplete(this) : "" } else { a.onError ? a.onError(this) : "" } } }; $.Ajax = { Request: function (c, d, e, a, b) { return Ajax.Request({ url: c, type: d || "get", data: e || "", onComplete: a, onError: b }) }, get: function (c, a, b) { return $.Ajax.Request(c + (c.indexOf("?") == -1 ? "?" : "&") + Math.random(), "get", "", a, b) }, post: function (c, d, a, b) { return $.Ajax.Request(c, "post", d, a, b) }, postXML: function (c, d, a, b) { return myAjax = new Ajax.Request({ url: c, type: "post", postBody: d, contentType: "text/xml", onComplete: a, onError: b }) }, update: function (a, b) { return $.Ajax.Request(a, (arguments[2] ? "post" : "get"), (arguments[2] ? arguments[2] : Math.random()), function (c) { if ("INPUT,SELECT,BUTTON,TEXTAREA".hasSubString($(b).tagName, ",")) { $(b).value = c.responseText } else { $(b).innerHTML = c.responseText } }) } }; $.Cookies = { get: function (d) { var b = "; " + document.cookie + "; "; var a = b.indexOf("; " + d + "="); if (a != -1) { var c = b.substring(a + d.length + 3, b.length); return unescape(c.substring(0, c.indexOf("; "))) } else { return null } }, set: function (b, j, c, k, f, a) { var d = c * 24 * 60 * 60 * 1000; var h = new Date(); h.setTime(h.getTime() + d); var g = c ? "; expires=" + h.toGMTString() : ""; var e = "; path=" + (k || "/"); var f = f ? "; domain=" + f : ""; document.cookie = b + "=" + escape(j) + g + f + e + (a ? "; secure" : "") }, del: function (c) { var b = new Date(); b.setTime(b.getTime() - 1); var a = this.get(c); if (a != null) { document.cookie = c + "=" + a + ";expires=" + b.toGMTString() } } }; $.Form = function (b) { var a = typeof b == "string" ? document.forms[b] : b; $.Form._Method.apply(a); return a }; $.Form._Method = function () { this.serialize = function (f) { var a = this.elements; var e = {}; for (var d = 0, c; c = a[d]; d++) { if (c.disabled || !c.name) { continue } if (c.type && c.type.toLowerCase().hasSubStrInArr(["radio", "checkbox"]) && !c.checked) { continue } var b = c.name.toLowerCase(); if (typeof e[b] == "undefined") { e[b] = [] } e[b].push($E(c.value)) } return $.Form.serialize(f, e) } }; $.Form.serialize = function (g) { var f = arguments[1] || {}; for (var e in g) { var b = e.toLowerCase(); if (typeof f[b] == "undefined") { f[b] = [] } f[b].push($E(g[e])) } var a = new StringBuffer(); for (var c in f) { for (var d = 0; d < f[c].length; d++) { a.append(c + "=" + f[c][d]) } } return a.toString("&") }; $.Request = function (b) { var a = location.search; if (!a.hasSubString("?")) { return "" } else { a = a.substring(1) } var c = {}; a.split("&").each(function (e) { var d = e.split("="); var f = d[0].toLowerCase(); c[f] = d[1] || "" }); return c[b.toLowerCase()] || "" }; $.Redirect = function (a, k) { if (!k) { setTimeout(function () { location.href = a }, 10); return } var d = {}; if (a.indexOf("?") != -1) { var h = a.substring(a.indexOf("?") + 1).split("&"); for (var e = 0; e < h.length; e++) { var c = h[e].split("="); d[c[0].toString().toLowerCase()] = c[1] || "" } } var g = k.split("&"); for (var e = 0; e < g.length; e++) { var c = g[e].split("="); d[c[0].toString().toLowerCase()] = c[1] || "" } var f = []; for (var b in d) { f.push(b + "=" + d[b]) } setTimeout(function () { location.href = a.substring(0, a.indexOf("?")) + "?" + f.join("&") }, 10) }; $.DOMReady = function (a) { $.DOMReady._methodArgument = a; return $.DOMReady.checkReady() }; $.DOMReady.checkReady = function () { if (document && document.getElementsByTagName && document.getElementById && document.body) { return $.DOMReady._methodArgument() } setTimeout("$.DOMReady.checkReady()", 10); return null }; window.$A = function (d) { var b = []; for (var c = 0, a = d.length; c < a; c++) { b[c] = d[c] } return b }; window.$D = function (a) { return decodeURIComponent(a) }; window.$E = function (a) { return encodeURIComponent(a) }; window.$V = function (a) { return $(a) ? ($(a).tagName.hasSubStrInArr(["INPUT", "TEXTAREA", "SELECT", "BUTTON"]) ? $(a).value : $(a).innerHTML) : "" }; window.$G = function (a) { return typeof (a) == "string" ? document.getElementById(a) : a }; window.$B = function (a) { return document.createElement(a) }; window.$T = function (a) { return document.createTextNode(a) }; window.$H = function (a) { return parseInt(a.style.height) || a.offsetHeight }; window.$W = function (a) { return parseInt(a.style.width) || a.offsetWidth }; window.$X = function (a) { var b = a.getBoundingClientRect(); return b.left }; window.$Y = function (a) { var b = a.getBoundingClientRect(); return b.top }; window.$aE = function (b, a, c) { c = c || document; if ($.Browse.isIE() != -1 && (document.all && !$.Browse.isOpera())) { c.attachEvent("on" + b, a) } else { c.addEventListener(b, a, false) } }; window.$aS = function (c, b, a) { if (!a) { $.Browse.isOpera() ? c.setAttribute("style", b) : c.style.cssText = b } else { $.Browse.isOpera() ? c.setAttribute("style", c.getAttribute("style") + b) : c.style.cssText += b } }; window.$aC = function (a, b) { if (!a.className) { a.className = b } else { a.className += " "; a.className += b } }; $.Lang = function (arg) { var msg_lang = eval("message." + lang); if (arg in msg_lang) { return eval("msg_lang." + arg) } if (arg in message.en) { return eval("message.en." + arg) } return 'Warning: "' + arg + '" is not in dictionary, Please add it!' }; var Wind = window.Wind || { UI: {} }; var Utils = { event: { getEvent: function () { if (document.all) { return window.event } func = this.getEvent.caller; while (func != null) { var a = func.arguments[0]; if (a) { if ((a.constructor == Event || a.constructor == MouseEvent) || (typeof (a) == "object" && a.preventDefault && a.stopPropagation)) { return a } } func = func.caller } return null }, addEventHandler: function (b, c, a) { if (b.addEventListener) { b.addEventListener(c, a, false) } else { if (b.attachEvent) { b.attachEvent("on" + c, a) } else { b["on" + c] = a } } }, removeEventHandler: function (b, c, a) { if (b.removeEventListener) { b.removeEventListener(c, a, false) } else { if (b.detachEvent) { b.detachEvent("on" + c, a) } else { b["on" + c] = null } } }, cancelEventBubble: function (a) { if (a) { if ($.Browse.isIE()) { a.cancelBubble = true } if ($.Browse.isFF()) { a.stopPropagation() } } }, clickBlankOutOfTarget: function (d, a, c, b) { Utils.event.addEventHandler(document, a, function () { if ($(d)) { var g = Utils.event.getEvent(); var f = $(d).offsetWidth; var e = $(d).offsetHeight; var j = Utils.getOffset($(d), "left") - document.documentElement.scrollLeft; var h = Utils.getOffset($(d), "top") - document.documentElement.scrollTop; if ($(d).style.display != "none") { if ((g.clientX < j || g.clientX > (j + f)) || (g.clientY < h || g.clientY > (h + e))) { b[c]() } } } }) } }, getOffset: function (c, b) { var a = 0; var d = c; if (typeof (c) == "string") { d = $(c) } if (b == "left") { while (d) { a += d.offsetLeft; d = d.offsetParent } } if (b == "top") { while (d) { a += d.offsetTop; d = d.offsetParent } } return a }, getPixel: function (a) { return parseInt(a.slice(0, a.indexOf("px"))) }, getStyle: function (b, a) { if (b) { if (document.defaultView) { return document.defaultView.getComputedStyle(b, null)[a] } else { return b.currentStyle[a] } } else { return "0px" } }, getDomHtml: function (b) { var a = document.createElement("div"); var c = b.cloneNode(true); a.appendChild(c); return a.innerHTML }, Mask: { loadMask: function () { if (!this.DivBG) { this.DivBG = document.createElement("div"); this.DivBG.id = "DivBG"; this.DivBG.className = "fixed-top fixed-left"; this.DivBG.style.background = "#000"; this.DivBG.style.width = "100%"; this.DivBG.style.height = "100%"; this.DivBG.style.zIndex = "999"; this.DivBG.style.opacity = "0.5"; this.DivBG.style.filter = "Alpha(opacity=50)" } if (!this.DivIframeBG) { this.DivIframeBG = document.createElement("iframe"); this.DivIframeBG.id = "IframeBG"; this.DivIframeBG.style.position = "absolute"; this.DivIframeBG.style.height = "100%"; this.DivIframeBG.style.width = "100%"; this.DivIframeBG.style.top = "0px"; this.DivIframeBG.style.left = "0px"; this.DivIframeBG.style.zIndex = -1; this.DivIframeBG.style.scrolling = "no"; this.DivIframeBG.frameborder = "0"; this.DivIframeBG.src = "about:blank"; this.DivBG.appendChild(this.DivIframeBG); document.body.appendChild(this.DivBG) } if ($.Browse.IEVer() == 6) { var a = function () { $("DivBG").style.height = document.documentElement.clientHeight + "px" }; a(); window.onresize = a } this.DivBG.style.display = "block"; this.DivIframeBG.style.display = "block" }, unloadMask: function () { this.DivBG.style.display = "none"; this.DivIframeBG.style.display = "none" } } }; Date.prototype.format = function (b) { var c = { "M+": this.getMonth() + 1, "d+": this.getDate(), "h+": this.getHours(), "m+": this.getMinutes(), "s+": this.getSeconds(), "q+": Math.floor((this.getMonth() + 3) / 3), S: this.getMilliseconds() }; if (/(y+)/.test(b)) { b = b.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length)) } for (var a in c) { if (new RegExp("(" + a + ")").test(b)) { b = b.replace(RegExp.$1, RegExp.$1.length == 1 ? c[a] : ("00" + c[a]).substr(("" + c[a]).length)) } } return b }; var JSON2; if (!JSON2) { JSON2 = {} } (function () {
    function f(n) { return n < 10 ? "0" + n : n } if (typeof Date.prototype.toJSON !== "function") { Date.prototype.toJSON = function (key) { return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + f(this.getUTCMonth() + 1) + "-" + f(this.getUTCDate()) + "T" + f(this.getUTCHours()) + ":" + f(this.getUTCMinutes()) + ":" + f(this.getUTCSeconds()) + "Z" : null }; String.prototype.toJSONInner = Number.prototype.toJSONInner = Boolean.prototype.toJSONInner = function (key) { return this.valueOf() } } var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, gap, indent, meta = { "\b": "\\b", "	": "\\t", "\n": "\\n", "\f": "\\f", "\r": "\\r", '"': '\\"', "\\": "\\\\" }, rep; function quote(string) { escapable.lastIndex = 0; return escapable.test(string) ? '"' + string.replace(escapable, function (a) { var c = meta[a]; return typeof c === "string" ? c : "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4) }) + '"' : '"' + string + '"' } function str(key, holder) { var i, k, v, length, mind = gap, partial, value = holder[key]; if (value && typeof value === "object" && typeof value.toJSONInner === "function") { value = value.toJSONInner(key) } if (typeof rep === "function") { value = rep.call(holder, key, value) } switch (typeof value) { case "string": return quote(value); case "number": return isFinite(value) ? String(value) : "null"; case "boolean": case "null": return String(value); case "object": if (!value) { return "null" } gap += indent; partial = []; if (Object.prototype.toString.apply(value) === "[object Array]") { length = value.length; for (i = 0; i < length; i += 1) { partial[i] = str(i, value) || "null" } v = partial.length === 0 ? "[]" : gap ? "[\n" + gap + partial.join(",\n" + gap) + "\n" + mind + "]" : "[" + partial.join(",") + "]"; gap = mind; return v } if (rep && typeof rep === "object") { length = rep.length; for (i = 0; i < length; i += 1) { if (typeof rep[i] === "string") { k = rep[i]; v = str(k, value); if (v) { partial.push(quote(k) + (gap ? ": " : ":") + v) } } } } else { for (k in value) { if (Object.prototype.hasOwnProperty.call(value, k)) { v = str(k, value); if (v) { partial.push(quote(k) + (gap ? ": " : ":") + v) } } } } v = partial.length === 0 ? "{}" : gap ? "{\n" + gap + partial.join(",\n" + gap) + "\n" + mind + "}" : "{" + partial.join(",") + "}"; gap = mind; return v } } if (typeof JSON2.stringify !== "function") { JSON2.stringify = function (value, replacer, space) { var i; gap = ""; indent = ""; if (typeof space === "number") { for (i = 0; i < space; i += 1) { indent += " " } } else { if (typeof space === "string") { indent = space } } rep = replacer; if (replacer && typeof replacer !== "function" && (typeof replacer !== "object" || typeof replacer.length !== "number")) { throw new Error("JSON2.stringify") } return str("", { "": value }) } } if (typeof JSON2.parse !== "function") { JSON2.parse = function (text, reviver) { var j; function walk(holder, key) { var k, v, value = holder[key]; if (value && typeof value === "object") { for (k in value) { if (Object.prototype.hasOwnProperty.call(value, k)) { v = walk(value, k); if (v !== undefined) { value[k] = v } else { delete value[k] } } } } return reviver.call(holder, key, value) } text = String(text); cx.lastIndex = 0; if (cx.test(text)) { text = text.replace(cx, function (a) { return "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4) }) } if (/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""))) { j = eval("(" + text + ")"); return typeof reviver === "function" ? walk({ "": j }, "") : j } throw new SyntaxError("JSON2.parse") } } if (typeof JSON2.dateFormat !== "function") {
        JSON2.dateFormat = function (jsonDate, format) {
            var d = jsonDate;
            if (typeof (d) == "string") {
                return eval("new " + d.substr(1, d.length - 2)).format(format)
            }
            else {
                return d.format(format);
            }
        }
    } if (typeof JSON2.strToDate !== "function") { JSON2.strToDate = function (date, format) { var reg = new RegExp(/y|d|h|M|s|m|q|S/gi); format = format.replace(reg, ""); var len = format.length; var arr = new Array(); var cmd = "/"; for (var i = 0; i < len; i++) { var sign = format.charAt(i); if (sign == " ") { cmd = ":"; continue } if (sign != cmd) { date = date.replace(sign, cmd) } } var dt = new Date(date); return "/Date(" + Date.UTC(dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours() - 8, dt.getMinutes(), dt.getSeconds()) + "+0800)/" } } if (typeof JSON2.regExDate !== "function") { JSON2.regExDate = function (str, p1, p2, offset, s) { str = str.substring(1).replace('"', ""); var date = str; if (/\/Date(.*)\//.test(str)) { str = str.match(/Date\((.*?)\)/)[1]; date = "new Date(" + parseInt(str) + ")" } else { var matches = str.split(/[-,:,T,Z]/); matches[1] = (parseInt(matches[1], 0) - 1).toString(); date = "new Date(Date.UTC(" + matches.join(",") + "))" } return date } }
})(); Wind.UI.PageBox = function () { if (arguments.length < 1) { throw new Error("Can not get ref by PageBox, maybe arguments raise a error") } var d = {}; for (var c in arguments[0]) { d[c] = arguments[0][c] } this.records = 0; this.grouppages = 10; this.pagesize = 20; this.currentpage = 1; this.callback = d.callback || false; this.imagepath = d.imagepath || ""; this.container = $(d.renderto); this.showbeginend = d.showbeginend || true; this.showupdown = d.showupdown || true; this.pagetext = d.pagetext || ""; this.appendbutton = d.appendbutton || false; this.ClassName = $(d.className); this.max = d.max || 10; this.pagecount = 0; this.toPageCode = 0; this.homePage = 0; this.endPage = 0; this.beginRecordCode; this.endRecordCode; this.lang = d.lang || "en"; page_self = this }; Wind.UI.PageBox.prototype = { DataBind: function (b) { if (typeof b != "object") { return this } this.records = parseInt(b[0].records) || 0; this.currentpage = parseInt(b[0].currentpage) || 1; this.grouppages = parseInt(b[0].grouppages) || 10; this.pagesize = parseInt(b[0].pagesize) || 20; this.showbeginend = b[0].showbeginend || this.showbeginend; this.showupdown = b[0].showupdown || this.showupdown; this.callback = b[0].callback || this.callback; this.container.innerHTML = ""; this.render() }, UpdateWords: function (c) { var d = this.container.getElementsByClassName("PageBox_Text")[0]; d.innerHTML = c.replaceAll("{begin}", this.beginRecordCode).replaceAll("{end}", this.endRecordCode).replaceAll("{count}", this.records).replaceAll("{pages}", this.pagecount).replaceAll("{pagesize}", this.pagesize) }, render: function () { this.pagecount = parseInt(this.records / this.pagesize); this.pagecount = this.records % this.pagesize == 0 ? this.pagecount : this.pagecount + 1; if (this.currentpage > this.pagecount && this.pagecount > 0) { this.currentpage = this.pagecount } var m, l; l = parseInt((this.max - 1) / 2); m = this.currentpage - l; if (m <= 0) { m = 1 } this.beginRecordCode = (this.currentpage - 1) * this.pagesize + 1; this.endRecordCode = this.currentpage * this.pagesize; if (this.endRecordCode > this.records) { this.endRecordCode = this.records } var k = $B("DIV"); k.className = "PageBox_PageNunber"; this.container.appendChild(k); if (this.showbeginend) { this.createHomePage() } if (this.showupdown) { this.createPrePage() } this.container.firstChild.appendChild($T(" ")); var j = 0; for (var n = m; n <= this.pagecount; n++) { if (j == this.max) { break } var h = $B("SPAN"); if (n == this.currentpage) { h.innerHTML = n; h.className = "current" } else { var o = $B("A"); o.onclick = this.callback; o.setAttribute("page", n); o.innerHTML = n; h.appendChild(o) } this.container.firstChild.appendChild(h); j++ } this.container.firstChild.appendChild($T(" ")); if (this.showupdown) { this.createNextPage() } if (this.showbeginend) { this.createEndPage() } if (this.appendbutton) { this.createAppendButton() } if (this.pagetext != "") { this.createPageText() } }, createPrePage: function () { if (this.imagepath) { var d = $B("img"); if (this.currentpage == 1) { d.src = this.imagepath + "page-prev-disabled.gif" } else { d.src = this.imagepath + "page-prev.gif"; d.onclick = this.callback } if (this.lang == "en") { d.alt = "Previous"; d.title = "Previous " } else { d.alt = "上页"; d.title = "上页 " } d.style.cursor = "pointer"; d.align = "AbsMiddle"; d.setAttribute("page", "pre"); this.container.firstChild.appendChild(d) } else { var e = $B("SPAN"); var f = $B("A"); f.onclick = this.callback; f.innerHTML = "Previous"; f.setAttribute("page", "pre"); e.appendChild(f); this.container.firstChild.appendChild(e) } }, createNextPage: function () { if (this.imagepath) { var d = $B("img"); if (this.currentpage == this.pagecount || !this.records) { d.src = this.imagepath + "page-next-disabled.gif" } else { d.src = this.imagepath + "page-next.gif"; d.onclick = this.callback } if (this.lang == "en") { d.alt = "Next page"; d.title = "Next page " } else { d.alt = "下页"; d.title = "下页 " } d.align = "AbsMiddle"; d.style.cursor = "pointer"; d.setAttribute("page", "next"); this.container.firstChild.appendChild(d) } else { var e = $B("SPAN"); var f = $B("A"); f.onclick = this.callback; f.innerHTML = "Next page"; f.setAttribute("page", "next"); e.appendChild(f); this.container.firstChild.appendChild(e) } }, createHomePage: function () { if (this.imagepath) { var e = $B("img"); if (this.currentpage == 1) { e.src = this.imagepath + "page-first-disabled.gif" } else { e.src = this.imagepath + "page-first.gif"; e.onclick = this.callback } if (this.lang == "en") { e.alt = "Home"; e.title = "Go to page 1" } else { e.alt = "首页"; e.title = "首页" } e.align = "AbsMiddle"; e.style.cursor = "pointer"; e.setAttribute("page", 1); this.container.firstChild.appendChild(e) } else { var f = $B("SPAN"); var d = $B("A"); d.onclick = this.callback; d.innerHTML = "Home"; if (this.lang == "en") { d.title = "Go to page 1" } else { d.title = "首页" } d.setAttribute("page", 1); f.appendChild(d); this.container.firstChild.appendChild(f) } }, createEndPage: function () { if (this.imagepath) { var d = $B("img"); if (this.currentpage == this.pagecount || !this.records) { d.src = this.imagepath + "page-last-disabled.gif" } else { d.src = this.imagepath + "page-last.gif"; d.onclick = this.callback } if (this.lang == "en") { d.alt = "Last Page"; d.title = "Go to page " + this.pagecount } else { d.alt = "末页"; d.title = "末页" } d.align = "AbsMiddle"; d.style.cursor = "pointer"; d.setAttribute("page", this.pagecount); this.container.firstChild.appendChild(d) } else { var e = $B("SPAN"); var f = $B("A"); f.onclick = this.callback; f.innerHTML = "Last Page"; if (this.lang == "en") { f.title = "Go to page " + this.pagecount } else { f.title = "末页" } f.setAttribute("page", this.pagecount); e.appendChild(f); this.container.firstChild.appendChild(e) } }, createAppendButton: function () { for (var c = 0; c < this.appendbutton.length; c++) { this.container.firstChild.appendChild($T(" ")); var d = $B("img"); d.src = this.appendbutton[c].src; if (this.appendbutton[c].click) { d.onclick = this.appendbutton[c].click } if (this.appendbutton[c].title) { d.alt = this.appendbutton[c].title; d.title = this.appendbutton[c].title } d.align = "AbsMiddle"; d.style.cursor = "pointer"; this.container.firstChild.appendChild(d) } }, createPageText: function () { var b = $B("div"); b.className = "PageBox_Text"; b.innerHTML = this.pagetext.replaceAll("{begin}", this.beginRecordCode).replaceAll("{end}", this.endRecordCode).replaceAll("{count}", this.records).replaceAll("{pages}", this.pagecount).replaceAll("{pagesize}", this.pagesize); this.container.appendChild(b) }, clear: function () { page_self.container.innerHTML = ""; page_self.container = null } }; Wind.UI.Calendar = function () { }; Wind.UI.Calendar.__instance = null; Wind.UI.Calendar.__getInstance = function () { if (!Wind.UI.Calendar.__instance) { Wind.UI.Calendar.__instance = new Wind.UI.Calendar() } return Wind.UI.Calendar.__instance }; Wind.UI.Calendar.show = function () { Wind.UI.Calendar.__getInstance().__setValue(arguments[0]).__render("jcorecalendarpanel") }; Wind.UI.Calendar.prototype = { __setValue: function (b) { if (typeof b.input == "string") { this.input = $(b.input) } else { this.input = b.input } this.lang = b.lang || this["lang"] || "cn"; this.exp = b.exp || this["exp"] || "yyyy-mm-dd"; this.mode = b.mode || this["mode"] || "default"; if (this.lang == "cn") { this.word = { year: "年", month: "月", week: ["日", "一", "二", "三", "四", "五", "六"], today: "今天", close: "关闭", confirm: "确定", cancel: "取消", time: "时间", months: ["一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "十一", "十二"], clear: "清空" } } else { this.word = { year: "年", month: "月", week: ["S", "M", "T", "W", "T", "F", "S"], today: "Today", close: "Close", confirm: "Ok", cancel: "Cancel", time: "time", months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"], clear: "clear" } } this.onselect = b.onselect || this["onselect"] || null; this.clickToday = b.clickToday || this["clickToday"] || null; this.iframeID = "Calendar_iframe"; this.frameID = "Calendar_frame"; this.previousMonthAID = "Calendar_a_previousMonth"; this.yearmonthPID = "Calendar_p_yearmonth"; this.nextMonthAID = "Calendar_a_nextMonth"; this.todayBtnID = "Calendar_btn_today"; this.mainTbodyID = "Calendar_main_tbody"; this.closeBtnID = "Calendar_btn_close"; this.timeBtnID = "Calendar_btn_time"; this.clearBtnID = "Calendar_btn_clear"; this.YMSelectPanelID = "Calendar_ymselectpanel"; this.TimeSelectPanelID = "Calendar_timeselectpanel"; this.MSelectPanelID = "Calendar_mselectpanel"; this.YSelectPanelID = "Calendar_yselectpanel"; this.HourSelectPanelID = "Calendar_hourselectpanel"; this.MinuteSelectPanelID = "Calendar_minuteselectpanel"; this.previousYearAID = "Calendar_a_previousYear"; this.nextYearAID = "Calendar_a_nextYear"; this.confirmYMSelectBtnID = "Calendar_btn_confirmYMSelect"; this.cancelYMSelectBtnID = "Calendar_btn_cancelYMSelect"; this.confirmHMSelectBtnID = "Calendar_btn_confirmHMSelect"; this.cancelHMSelectBtnID = "Calendar_btn_cancelHMSelect"; this.weektextTrID = "Calendar_tr_weektext"; this.bottomTdID = "Calendar_td_bottom"; this.today = new Date(); return this }, __bindEvent: function () { Utils.event.clickBlankOutOfTarget(this.frameID, "mousedown", "__close", this); Utils.event.addEventHandler($(this.previousMonthAID), "mousedown", function (b) { return function () { b.__previousMonth() } }(this)); Utils.event.addEventHandler($(this.nextMonthAID), "mousedown", function (b) { return function () { b.__nextMonth() } }(this)); Utils.event.addEventHandler($(this.yearmonthPID), "mousedown", function (b) { return function () { b.__showYMSelectPanel() } }(this)); this.__bindEventReflash() }, __bindEventReflash: function () { Utils.event.addEventHandler($(this.todayBtnID), "mousedown", function (a) { return function () { a.__today() } }(this)); Utils.event.addEventHandler($(this.closeBtnID), "mousedown", function (a) { return function () { a.__close() } }(this)); if (this.mode == "time") { Utils.event.addEventHandler($(this.timeBtnID), "mousedown", function (a) { return function () { a.__showTimeSelectPanel() } }(this)) } var c = $("#" + this.mainTbodyID + " td"); for (var d = 0; d < c.length; d++) { Utils.event.addEventHandler(c[d], "mousedown", function (a) { return function () { a.__select(this) } }(this)) } Utils.event.addEventHandler($(this.clearBtnID), "click", function (a) { return function () { a.__clear() } }(this)) }, __render: function (h) { if (this.mode == "onlytime") { alert(this.mode) } this.__setDate(); if (!$(h)) { var g = document.createElement("div"); g.id = h; document.body.appendChild(g) } if ($(h).innerHTML == "") { var e = new StringBuffer(); e.append("<iframe id='{0}' frameborder='0' style='position:absolute; z-index:50; width:186px; height:206px;' ></iframe>".format(this.iframeID)); e.append("<div id='{0}' class='calendar_frame'>".format(this.frameID)); e.append("<table cellspacing='0'>"); e.append("<tbody>"); e.append("<tr>"); e.append("<td id='{0}' class='calendar-head-left'><a >&nbsp;</a></td>".format(this.previousMonthAID)); e.append("<td align='center' class='calendar-head-middle' >"); e.append("<table><tr><td><p id='{0}'>{1}</p></td></tr></table>".format(this.yearmonthPID, this.__getYearMonthText())); e.append("</td>"); e.append("<td id='{0}' class='calendar-head-right'><a >&nbsp;</a></td>".format(this.nextMonthAID)); e.append("</tr>"); e.append("<tr><td colspan='3'><table cellspacing='0' class='calendar-body'><thead><tr id='{0}'>".format(this.weektextTrID)); for (var f = 0; f < this.word.week.length; f++) { e.append("<th><span>{0}</span></th>".format(this.word.week[f])) } e.append("</tr></thead><tbody><tr>"); e.append("<td colspan='7' id='{0}'>".format(this.mainTbodyID)); e.append(this.__renderMain()); e.append("</td></tr></tbody>"); e.append("</table></td></tr>"); e.append("<tr><td id='{0}' align='center' class='calendar-bottom' colspan='3'>{1}".format(this.bottomTdID, this.__reflashBottom())); e.append("</td></tr></tbody></table></div>"); $(h).innerHTML = e.toString(); e.clear(); this.__bindEvent() } else { this.__reflashMainPanel(); this.__bindEventReflash(); if ($(this.YMSelectPanelID)) { $(this.YMSelectPanelID).style.display = "none" } if ($(this.TimeSelectPanelID)) { $(this.TimeSelectPanelID).style.display = "none" } } this.__setFrameStyle() }, __renderMain: function () { var l = new Date(this.yearselected, this.monthselected, 1).getDay(); var k = 0; var j = false; var m = new StringBuffer(); m.append("<table {0}>".format($.Browse.isIE() ? "style='height:140px;'" : "")); for (var n = 0; n < 6; n++) { m.append("<tr>"); for (var o = 0; o < 7; o++) { if (l > 0) { m.append(this.__renderTD(this.__getDay(-l).getDate(), "calendar-body-td-gray", o)); l-- } else { var h = this.__getDay(k).getDate(); if (h == 1 && k > 27) { j = true } if (j) { m.append(this.__renderTD(h, "calendar-body-td-gray", o)) } else { if (this.__checkSelected(h)) { m.append(this.__renderTD(h, "calendar-body-td-selected", o)) } else { if (this.__checkToday(h)) { m.append(this.__renderTD(h, "calendar-body-td-today", o)) } else { m.append(this.__renderTD(h, "calendar-body-td-active", o)) } } } k++ } } m.append("</tr>") } m.append("</table>"); return m.toString() }, __renderTD: function (d, f, e) { if ((e == 0 || e == 6) && f != "calendar-body-td-gray") { return "<td class='{0}' title=''><a  style='color:{2}'>{1}</a></td>".format(f, d, "red") } else { return "<td class='{0}' title=''><a >{1}</a></td>".format(f, d) } }, __setFrameStyle: function () { $(this.frameID).style.left = "0px"; $(this.frameID).style.top = "0px"; $(this.iframeID).style.left = "0px"; $(this.iframeID).style.top = "0px"; if ($(this.frameID).style.display == "none") { $(this.frameID).style.display = "block"; $(this.iframeID).style.display = "block" } var b = this.__getLeftTop(); $(this.frameID).style.left = b.left + "px"; $(this.frameID).style.top = b.top + "px"; $(this.iframeID).style.left = b.left + "px"; $(this.iframeID).style.top = b.top + "px" }, __setYMSelPanelStyle: function () { $(this.YMSelectPanelID).style.left = "0px"; $(this.YMSelectPanelID).style.top = "0px"; if ($(this.YMSelectPanelID).style.display == "none") { $(this.YMSelectPanelID).style.display = "block" } var b = this.__getLeftTop(); $(this.YMSelectPanelID).style.left = b.left + "px"; $(this.YMSelectPanelID).style.top = b.top + "px" }, __setHMSelPanelStyle: function () { $(this.TimeSelectPanelID).style.left = "0px"; $(this.TimeSelectPanelID).style.top = "0px"; if ($(this.TimeSelectPanelID).style.display == "none") { $(this.TimeSelectPanelID).style.display = "block" } var d = this.__getLeftTop(); $(this.TimeSelectPanelID).style.left = d.left + "px"; $(this.TimeSelectPanelID).style.top = d.top + "px"; var f = $("#" + this.HourSelectPanelID + " td"); for (var e = 0; e < f.length; e++) { if (f[e].childNodes[0].innerHTML == this.hour) { f[e].className = "sel" } else { f[e].className = "" } } f = $("#" + this.MinuteSelectPanelID + " td"); for (var e = 0; e < f.length; e++) { if (f[e].childNodes[0].innerHTML == this.minute) { f[e].className = "sel" } else { f[e].className = "" } } }, __getDay: function (c) { var d = new Date(this.yearselected, this.monthselected, 1); d.setDate(d.getDate() + c); return d }, __getYearMonthText: function () { var b; if (this.lang == "cn") { b = this.yearselected + this.word.year + "&nbsp;" + (this.monthselected + 1) + this.word.month } else { b = this.word.months[this.monthselected] + "&nbsp;" + this.yearselected } return b }, __reflashMainPanel: function () { $(this.bottomTdID).innerHTML = this.__reflashBottom(); $(this.yearmonthPID).innerHTML = this.__getYearMonthText(); $(this.mainTbodyID).innerHTML = this.__renderMain() }, __previousMonth: function () { this.__setDate2(-1); this.__reflashMainPanel(); this.__bindEventReflash() }, __nextMonth: function () { this.__setDate2(1); this.__reflashMainPanel(); this.__bindEventReflash() }, __previousYear: function () { this.firstyear -= 10; $(this.YSelectPanelID).innerHTML = this.__renderYearPanel(); this.__bindEventReflash_YSel() }, __nextYear: function () { this.firstyear += 10; $(this.YSelectPanelID).innerHTML = this.__renderYearPanel(); this.__bindEventReflash_YSel() }, __today: function () { this.yearselected = this.today.getFullYear(); this.monthselected = this.today.getMonth(); this.dateselected = this.today.getDate(); if (this.mode != "time") { this.__outputDate(); this.__close() } else { this.__showTimeSelectPanel() } if (this.clickToday) { this.clickToday() } }, __close: function () { if ($(this.frameID)) { $(this.frameID).style.display = "none"; $(this.iframeID).style.display = "none" } if ($(this.YMSelectPanelID)) { $(this.YMSelectPanelID).style.display = "none" } if ($(this.TimeSelectPanelID)) { $(this.TimeSelectPanelID).style.display = "none" } }, __confirmYMSel: function () { var c = $("#" + this.MSelectPanelID + " td"); for (var d = 0; d < c.length; d++) { if (c[d].className == "sel") { this.monthselected = parseInt(c[d].childNodes[0].getAttribute("index")) } } c = $("#" + this.YSelectPanelID + " td"); for (var d = 0; d < c.length; d++) { if (c[d].className == "sel") { this.yearselected = parseInt(c[d].childNodes[0].innerHTML) } } this.__cancelYMSel(); this.__reflashMainPanel(); this.__bindEventReflash() }, __cancelYMSel: function () { $(this.YMSelectPanelID).style.display = "none" }, __confirmHMSel: function () { var c = $("#" + this.HourSelectPanelID + " td"); for (var d = 0; d < c.length; d++) { if (c[d].className == "sel") { this.hour = c[d].childNodes[0].innerHTML } } c = $("#" + this.MinuteSelectPanelID + " td"); for (var d = 0; d < c.length; d++) { if (c[d].className == "sel") { this.minute = c[d].childNodes[0].innerHTML } } this.__cancelHMSel(); this.__outputDate(); this.__close() }, __cancelHMSel: function () { $(this.TimeSelectPanelID).style.display = "none" }, __select: function (f) { var d; if ($.Browse.isIE()) { var e = Utils.event.getEvent(); if (e.srcElement.nodeName == "A") { this.dateselected = e.srcElement.innerHTML } else { if (e.srcElement.nodeName == "TD") { this.dateselected = e.srcElement.childNodes[0].innerHTML } } d = e.srcElement.parentNode.className } else { this.dateselected = f.childNodes[0].innerHTML; d = f.className } if (d == "calendar-body-td-gray") { if (parseInt(this.dateselected) > 15) { if (this.monthselected == 0) { this.monthselected = 11; this.yearselected-- } else { this.monthselected-- } } else { if (this.monthselected == 11) { this.monthselected = 0; this.yearselected++ } else { this.monthselected++ } } } if (this.mode != "time") { this.__outputDate(); this.__close() } else { this.__showTimeSelectPanel() } if (this.onselect) { this.onselect() } }, __selectMonth: function (j) { var k = $("#" + this.MSelectPanelID + " td"); for (var f = 0; f < k.length; f++) { k[f].className = "" } var h = j; if ($.Browse.isIE()) { var g = Utils.event.getEvent(); h = g.srcElement.parentNode } h.className = "sel" }, __selectYear: function (j) { var k = $("#" + this.YSelectPanelID + " td"); for (var f = 0; f < k.length; f++) { k[f].className = "" } var h = j; if ($.Browse.isIE()) { var g = Utils.event.getEvent(); h = g.srcElement.parentNode } h.className = "sel" }, __selectHour: function (j) { var k = $("#" + this.HourSelectPanelID + " td"); for (var f = 0; f < k.length; f++) { k[f].className = "" } var h = j; if ($.Browse.isIE()) { var g = Utils.event.getEvent(); h = g.srcElement.parentNode } h.className = "sel" }, __selectMinute: function (j) { var k = $("#" + this.MinuteSelectPanelID + " td"); for (var f = 0; f < k.length; f++) { k[f].className = "" } var h = j; if ($.Browse.isIE()) { var g = Utils.event.getEvent(); h = g.srcElement.parentNode } h.className = "sel" }, __getSpliter: function () { for (var d = 0; d < this.exp.length; d++) { var c = this.exp.charAt(d); if (c != "y" && c != "m" && c != "d") { return c } } }, __outputDate: function () { var g = this.__getSpliter(); var h = this.exp.split(g); var f = []; for (var e = 0; e < h.length; e++) { f.push(this.__buling(this.__getYMD(h[e]), 2)) } this.input.value = f.join(g); if (this.mode == "time") { if (this.hour && this.minute) { this.input.value += " " + this.__buling(this.hour, 2) + ":" + this.__buling(this.minute, 2) } } }, __buling: function (h, g) { var k = ""; var b = g - h.toString().length; if (b > 0) { for (var j = 0; j < b; j++) { k += "0" } } return k + h }, __getYMD: function (b) { switch (b) { case "yyyy": return this.yearselected; case "mm": return this.monthselected + 1; case "dd": return this.dateselected } }, __getYMDIndex: function (f) { var d = this.exp.split(this.__getSpliter()); for (var e = 0; e < d.length; e++) { if (f == d[e]) { return e } } }, __setDate: function () { if (this.input && this.input.value != "") { var d = this.__getSpliter(); var e; e = this.input.value.split(" ")[0].split(d); if (e.length != 3) { alert("日期输入不符合规则"); return } this.yearselected = e[this.__getYMDIndex("yyyy")]; this.monthselected = e[this.__getYMDIndex("mm")] - 1; this.dateselected = e[this.__getYMDIndex("dd")]; this.selected = new Date(this.yearselected, this.monthselected, this.dateselected); var f = this.input.value.split(" ")[1]; this.hour = this.minute = 0; if (f) { if (f.split(":").length == 2) { this.hour = f.split(":")[0]; this.minute = f.split(":")[1] } } } else { this.yearselected = this.today.getFullYear(); this.monthselected = this.today.getMonth(); this.dateselected = this.today.getDate(); this.hour = this.minute = 0 } this.firstyear = this.yearselected - 4 }, __setDate2: function (d) { var c = new Date(this.yearselected, this.monthselected, 15); c.setMonth(c.getMonth() + d); this.yearselected = c.getFullYear(); this.monthselected = c.getMonth() }, __checkSelected: function (b) { if (this.selected) { if (this.yearselected == this.selected.getFullYear() && this.monthselected == this.selected.getMonth() && b == this.selected.getDate()) { return true } else { return false } } else { return false } }, __checkToday: function (b) { if (this.yearselected == this.today.getFullYear() && this.monthselected == this.today.getMonth() && b == this.today.getDate()) { return true } else { return false } }, __showYMSelectPanel: function () { if (!$(this.YMSelectPanelID)) { var d = new StringBuffer(); d.append("<div id='{0}' class='calendar_YMSelPanel'>".format(this.YMSelectPanelID)); d.append("<div class='calendar_frame_YMselect'>"); if (this.lang == "en") { d.append("<div id='{0}' class='calendar_frame_YMselect_l'>".format(this.MSelectPanelID)); d.append(this.__renderMonthPanel()) } else { d.append("<div class='calendar_frame_YMselect_l'>"); d.append("<table cellspacing='0'><tr>"); d.append("<td style='padding-top:9px;' class='calendar_frame_Yselect'><a id='{0}'  class='calendar_frame_Yselect_prev'></a></td>".format(this.previousYearAID)); d.append("<td style='padding-top:9px;' class='calendar_frame_Yselect'><a id='{0}' class='calendar_frame_Yselect_next'></a></td>".format(this.nextYearAID)); d.append("</tr><tr><td id='{0}' colspan='2'>".format(this.YSelectPanelID)); d.append(this.__renderYearPanel()); d.append(" </td></tr></table>") } d.append("</div>"); if (this.lang == "en") { d.append("<div class='calendar_frame_YMselect_r'>"); d.append("<table cellspacing='0'><tr>"); d.append("<td style='padding-top:9px;' class='calendar_frame_Yselect'><a id='{0}'  class='calendar_frame_Yselect_prev'></a></td>".format(this.previousYearAID)); d.append("<td style='padding-top:9px;' class='calendar_frame_Yselect'><a id='{0}'  class='calendar_frame_Yselect_next'></a></td>".format(this.nextYearAID)); d.append("</tr><tr><td id='{0}' colspan='2'>".format(this.YSelectPanelID)); d.append(this.__renderYearPanel()); d.append(" </td></tr></table>") } else { d.append("<div id='{0}' class='calendar_frame_YMselect_r'>".format(this.MSelectPanelID)); d.append(this.__renderMonthPanel()) } d.append(" </div>"); d.append("</div><div class='calendar-bottom'>"); d.append("<button id='{0}' type='button' >{1}</button>".format(this.confirmYMSelectBtnID, this.word.confirm)); d.append("<button id='{0}' type='button' >{1}</button>".format(this.cancelYMSelectBtnID, this.word.cancel)); d.append("</div></div>"); var c = document.createElement("div"); c.id = "jcorecalendarYMSelectPanel"; document.body.appendChild(c); $("jcorecalendarYMSelectPanel").innerHTML = d.toString(); d.clear(); this.__bindEvent_YMSel() } else { $(this.MSelectPanelID).innerHTML = this.__renderMonthPanel(); $(this.YSelectPanelID).innerHTML = this.__renderYearPanel(); this.__bindEventReflash_YSel(); $(this.confirmYMSelectBtnID).innerHTML = this.word.confirm; $(this.cancelYMSelectBtnID).innerHTML = this.word.cancel } this.__setYMSelPanelStyle() }, __showTimeSelectPanel: function () { if (!$(this.TimeSelectPanelID)) { var d = new StringBuffer(); d.append("<div id='{0}' class='calendar_YMSelPanel'>".format(this.TimeSelectPanelID)); d.append("<div class='calendar_frame_YMselect'>"); d.append("<div id='{0}' class='calendar_frame_YMselect_l' style='width:123px;'>".format(this.HourSelectPanelID)); d.append(this.__renderHourPanel()); d.append("</div>"); d.append("<div id='{0}' class='calendar_frame_YMselect_r' style='width:62px;'>".format(this.MinuteSelectPanelID)); d.append(this.__renderMinutePanel()); d.append("</div></div><div class='calendar-bottom'>"); d.append("<button id='{0}' type='button' >{1}</button>".format(this.confirmHMSelectBtnID, this.word.confirm)); d.append("<button id='{0}' type='button' >{1}</button>".format(this.cancelHMSelectBtnID, this.word.cancel)); d.append("</div></div>"); var c = document.createElement("div"); c.id = "jcorecalendarTimeSelectPanel"; document.body.appendChild(c); $(c.id).innerHTML = d.toString(); d.clear(); this.__bindEvent_HMSel() } $(this.confirmHMSelectBtnID).innerHTML = this.word.confirm; $(this.cancelHMSelectBtnID).innerHTML = this.word.cancel; this.__setHMSelPanelStyle() }, __renderMonthPanel: function () { var c = new StringBuffer(); c.append("<table cellspacing='5'>"); for (var d = 0; d < this.word.months.length - 6; d++) { c.append("<tr>"); if (d == this.monthselected) { c.append("<td class='sel'><a  index='{1}'>{0}</a></td>".format(this.lang == "cn" ? this.word.months[d] : this.word.months[d].substr(0, 3), d)) } else { c.append("<td><a  index='{1}'>{0}</a></td>".format(this.lang == "cn" ? this.word.months[d] : this.word.months[d].substr(0, 3), d)) } if (d + 6 == this.monthselected) { c.append("<td class='sel'><a  index='{1}'>{0}</a></td>".format(this.lang == "cn" ? this.word.months[d + 6] : this.word.months[d + 6].substr(0, 3), d + 6)) } else { c.append("<td><a  index='{1}'>{0}</a></td>".format(this.lang == "cn" ? this.word.months[d + 6] : this.word.months[d + 6].substr(0, 3), d + 6)) } c.append("</tr>") } c.append("</table>"); return c.toString() }, __renderYearPanel: function () { var c = new StringBuffer(); c.append("<table cellspacing='5'>"); for (var d = this.firstyear; d < this.firstyear + 5; d++) { c.append("<tr>"); if (d == this.yearselected) { c.append("<td class='sel'><a >{0}</a></td>".format(d)) } else { c.append("<td><a>{0}</a></td>".format(d)) } if (d + 5 == this.yearselected) { c.append("<td class='sel'><a >{0}</a></td>".format(d + 5)) } else { c.append("<td><a >{0}</a></td>".format(d + 5)) } c.append("</tr>") } c.append("</table>"); return c.toString() }, __renderHourPanel: function () { var c = new StringBuffer(); c.append("<table cellspacing='0'>"); for (var d = 0; d < 24; d++) { c.append("<tr>"); c.append("<td><a >{0}</a></td>".format(d)); c.append("<td><a >{0}</a></td>".format(++d)); c.append("<td><a >{0}</a></td>".format(++d)); c.append("<td><a >{0}</a></td>".format(++d)); c.append("</tr>") } c.append("</table>"); return c.toString() }, __renderMinutePanel: function () { var c = new StringBuffer(); c.append("<table cellspacing='0'>"); for (var d = 0; d < 60; d += 5) { c.append("<tr>"); c.append("<td><a >{0}</a></td>".format(d == 0 ? "00" : "" + d)); c.append("<td><a >{0}</a></td>".format((d += 5) == "5" ? "05" : "" + d)); c.append("</tr>") } c.append("</table>"); return c.toString() }, __bindEvent_YMSel: function () { Utils.event.addEventHandler($(this.previousYearAID), "mousedown", function (b) { return function () { b.__previousYear() } }(this)); Utils.event.addEventHandler($(this.nextYearAID), "mousedown", function (b) { return function () { b.__nextYear() } }(this)); Utils.event.addEventHandler($(this.confirmYMSelectBtnID), "mousedown", function (b) { return function () { b.__confirmYMSel() } }(this)); Utils.event.addEventHandler($(this.cancelYMSelectBtnID), "mousedown", function (b) { return function () { b.__cancelYMSel() } }(this)); this.__bindEventReflash_YSel() }, __bindEvent_HMSel: function () { var c = $("#" + this.HourSelectPanelID + " td"); for (var d = 0; d < c.length; d++) { Utils.event.addEventHandler(c[d], "click", function (a) { return function () { a.__selectHour(this) } }(this)) } c = $("#" + this.MinuteSelectPanelID + " td"); for (var d = 0; d < c.length; d++) { Utils.event.addEventHandler(c[d], "click", function (a) { return function () { a.__selectMinute(this) } }(this)) } Utils.event.addEventHandler($(this.confirmHMSelectBtnID), "mousedown", function (a) { return function () { a.__confirmHMSel() } }(this)); Utils.event.addEventHandler($(this.cancelHMSelectBtnID), "mousedown", function (a) { return function () { a.__cancelHMSel() } }(this)) }, __bindEventReflash_YSel: function () { var c = $("#" + this.MSelectPanelID + " td"); for (var d = 0; d < c.length; d++) { Utils.event.addEventHandler(c[d], "click", function (a) { return function () { a.__selectMonth(this) } }(this)) } c = $("#" + this.YSelectPanelID + " td"); for (var d = 0; d < c.length; d++) { Utils.event.addEventHandler(c[d], "click", function (a) { return function () { a.__selectYear(this) } }(this)) } }, __getLeftTop: function () { var b = {}; if (Utils.getOffset(this.input, "left") - document.documentElement.scrollLeft + $(this.frameID).offsetWidth > document.documentElement.clientWidth) { b.left = Utils.getOffset(this.input, "left") - $(this.frameID).offsetWidth + this.input.offsetWidth } else { b.left = Utils.getOffset(this.input, "left") } if (Utils.getOffset(this.input, "top") - document.documentElement.scrollTop + this.input.offsetHeight + $(this.frameID).offsetHeight > document.documentElement.clientHeight) { b.top = Utils.getOffset(this.input, "top") - $(this.frameID).offsetHeight } else { b.top = Utils.getOffset(this.input, "top") + this.input.offsetHeight } return b }, __reflashWeekText: function () { var d = $("#" + this.weektextTrID + " th"); for (var c = 0; c < d.length; c++) { d[c].childNodes[0].innerHTML = this.word.week[c] } }, __reflashBottom: function () { var b = new StringBuffer(); b.append("<button id='{0}' type='button'>{1}</button><button id='{2}' type='button'>{3}</button>".format(this.todayBtnID, this.word.today, this.closeBtnID, this.word.close)); if (this.mode == "time") { b.append("<button id='{0}' type='button'>{1}</button>".format(this.timeBtnID, this.word.time)) } b.append("<button id='{0}' type='button'>{1}</button>".format(this.clearBtnID, this.word.clear)); return b.toString() }, __clear: function () { this.input.value = ""; this.__close() } }; Wind.UI.Hint = function () { var e = arguments[0] || {}; var d = e.target; var h = e.msg; var c = e.time || 3; var b = e.width || "100%"; var a = e.height || "100%"; var g = d + "_hint"; if ($(g)) { document.body.removeChild($(g)) } var f = document.createElement("div"); f.setAttribute("id", g); f.className = "hint_panel"; f.style.display = "none"; f.innerHTML = ("<div class='hint_inner' style='width:{0}px;height:{1}px;'>{2}</div>").format(Wind.UI.Hint.__formatWHCssText(b), Wind.UI.Hint.__formatWHCssText(a), h); document.body.appendChild(f); Utils.event.addEventHandler($(d), "mouseover", function () { Wind.UI.Hint.__show(g, d, c) }); Utils.event.addEventHandler($(d), "mouseout", function () { Wind.UI.Hint.__close(g) }) }; Wind.UI.Hint.__formatWHCssText = function (a) { if (typeof a == "number") { return a + "px" } else { if (a == undefined) { return "100%" } else { return a } } }; Wind.UI.Hint.__show = function (c, b, a) { $(c).style.display = "block"; if (document.documentElement.clientWidth > (Utils.getOffset($(b), "left") + $(b).offsetWidth + $(c).offsetWidth)) { $(c).style.left = (Utils.getOffset($(b), "left") + $(b).offsetWidth) + "px"; $(c).style.top = Utils.getOffset($(b), "top") + "px" } else { $(c).style.left = (document.documentElement.clientWidth - $(c).offsetWidth) + "px"; $(c).style.top = (Utils.getOffset($(b), "top") + $(b).offsetHeight) + "px" } setTimeout(function () { Wind.UI.Hint.__close(c) }, 1000 * a) }; Wind.UI.Hint.__close = function (a) { $(a).style.display = "none" }; Wind.UI.Mask = function () { this.object = $B("SPAN"); document.body.appendChild(this.object); this.object.style.left = 0; this.object.style.top = 0; this.object.style.height = 0; this.object.style.width = 0; this.object.style.visibility = "hidden"; this.object.style.position = "absolute"; this.object.style.zIndex = 10000; this.brightness; this.div; m_self = this }; Wind.UI.Mask.prototype = { show: function (a, b) { m_self.brightness = b || 8; m_self.object.style.left = $X($(a)); m_self.object.style.top = $Y($(a)); m_self.object.style.height = $(a).offsetHeight; m_self.object.style.width = $(a).offsetWidth; m_self.object.style.visibility = ""; m_self.shadeVeil(0); Utils.Mask.loadMask() }, hide: function () { m_self.object.style.left = 0; m_self.object.style.top = 0; m_self.object.style.height = 0; m_self.object.style.width = 0; m_self.object.innerHTML = ""; m_self.object.style.visibility = "hidden"; Utils.Mask.unloadMask() }, shadeVeil: function (a) { if ($.Browse.isIE()) { m_self.object.innerHTML = '<div style="height:100%;width:100%;background:black;filter:alpha(opacity=' + a + ')"></div>' } else { m_self.object.innerHTML = '<div style="height:100%;width:100%;background-color:#D8D8D7;-moz-opacity:' + a / 10 + ';"></div>' } if (a < m_self.brightness) { window.setTimeout("m_self.shadeVeil(" + (a + 1) + ")", 50) } }, veil: function (a) { if ($.Browse.isIE()) { this.object.innerHTML = '<div style="height:100%;width:100%;background-color:black;filter:alpha(opacity=' + a + ')"></div>' } else { this.object.innerHTML = '<div style="height:100%;width:100%;background-color:#D8D8D7;-moz-opacity:' + a / 10 + ';"></div>' } }, showWait: function (b, d, c, a) { if (!this.div) { this.div = $B("DIV") } this.brightness = c || 6; document.body.appendChild(this.div); this.div.className = "x-mask-progress"; if (a && a.left) { this.div.style.left = a.left + "px" } else { this.div.style.left = ($X($(b)) + Math.round($(b).clientWidth / 2) - 90) + "px" } if (a && a.top) { this.div.style.top = a.top + "px" } else { this.div.style.top = (document.documentElement.scrollTop * 2 + document.documentElement.clientHeight - this.div.offsetHeight) / 2 + "px" } this.div.style.position = "absolute"; this.div.style.zIndex = 10000; if (!d) { d = "Loading,please wait..." } this.div.innerHTML = '<div class="x-mask-container"><div class="x-mask-header">' + d + '</div><div class="x-mask-body"></div></div>'; this.veil(this.brightness); Utils.Mask.loadMask() }, showWaitOnTarget: function (a, c, b) { if (!this.div) { this.div = $B("DIV") } this.brightness = b || 6; document.body.appendChild(this.div); this.object.style.left = $X($(a)) + "px"; this.object.style.top = $Y($(a)) + "px"; this.object.style.height = $(a).offsetHeight + "px"; this.object.style.width = $(a).offsetWidth + "px"; this.object.style.visibility = ""; this.div.className = "x-mask-progress"; this.div.style.left = ($X($(a)) + Math.round($(a).clientWidth / 2) - 90) + "px"; this.div.style.top = ($Y($(a)) + Math.round($(a).clientHeight / 2) - 36) + "px"; this.div.style.position = "absolute"; this.div.style.zIndex = 10000; if (!c) { c = "Loading,please wait..." } this.div.innerHTML = '<div class="x-mask-container"><div class="x-mask-header">' + c + '</div><div class="x-mask-body"></div></div>'; this.veil(this.brightness) }, hideWait: function () { this.object.style.left = 0; this.object.style.top = 0; this.object.style.height = 0; this.object.style.width = 0; this.object.innerHTML = ""; this.object.style.visibility = "hidden"; if (this.div) { document.body.removeChild(this.div) } Utils.Mask.unloadMask() }, hideWaitOnTarget: function () { this.object.style.left = 0; this.object.style.top = 0; this.object.style.height = 0; this.object.style.width = 0; this.object.innerHTML = ""; this.object.style.visibility = "hidden"; if (this.div) { document.body.removeChild(this.div) } }, dispose: function () { m_self.object.innerHTML = ""; m_self.object = null } }; Wind.UI.Window = function () { var a = arguments[0] || {}; this.itemCount = 0; this.width = a.width || 400; this.height = a.height || 300; this.left = a.left; this.top = a.top; this.__calcShape({ width: this.width, height: this.height }); this.title = a.title || "&nbsp;"; this.img = a.img; this.isreflashable = a.isreflashable || false; this.ismaxable = a.ismaxable ? true : a.ismaxable; this.isshowclose = a.isshowclose ? true : a.isshowclose; this.isresizeable = a.isresizeable || false; this.isdragable = a.isdragable ? true : a.isdragable; this.ismask = a.ismask || false; if (this.ismask) { this.ismaxable = this.isresizeable = false } this.data = a.data; this.mode = a.mode; this.url = a.url; this.isscroll = a.isscroll ? true : a.isscroll; this.imagePath = a.imagePath; this.onclose = a.onclose; this.frame = $B("div"); this.container = $B("div"); this.rzproxy = $B("div"); this.iDiffX = 0; this.iDiffY = 0; this.lastWidth = 0; this.lastHeight = 0; this.cWidth = 0; this.cHeight = 0; this.maxWidth = 200; this.maxHeight = 200; this.index = Wind.UI.Window.index; Wind.UI.Window.index++ }; Wind.UI.Window.index = 0; Wind.UI.Window.prototype = { __render: function () { if (this.isFirstLoad) { if (!$("#jcorewindowpanel_" + this.index)) { var a = document.createElement("div"); a.id = "jcorewindowpanel_" + this.index; document.body.appendChild(a) } if (this.isresizeable || this.isdragable) { $("#jcorewindowpanel_" + this.index).innerHTML = this.__getframeHTML() + this.__getproxyHTML() } else { $("#jcorewindowpanel_" + this.index).innerHTML = this.__getframeHTML() } this.__setproxystyle(); this.__setcontainerstyle(); this.__setframestyle(); this.loadData(this.data); this.__bindEvent() } }, close: function () { $(this.frame.id).style.display = "none"; if (this.ismask) { Utils.Mask.unloadMask() } Utils.event.cancelEventBubble(Utils.event.getEvent()) }, show: function () { if (this.isFirstLoad == undefined) { this.isFirstLoad = true } else { this.isFirstLoad = false } this.__render(); if (this.ismask) { Utils.Mask.loadMask() } $(this.frame.id).style.display = "block" }, dispose: function () { document.body.removeChild($("#jcorewindowpanel_" + this.index)) }, __max: function () { if ($("#tool_max_" + this.index).className == "tool tool-max") { $("#tool_max_" + this.index).className = "tool tool-recover"; this.lastWidth2 = $(this.container.id).offsetWidth; this.lastHeight2 = $(this.container.id).offsetHeight; this.setStyle(document.documentElement.scrollWidth - 2, document.documentElement.clientHeight - 40); $(this.frame.id).style.left = "0px"; $(this.frame.id).style.top = "0px" } else { $("#tool_max_" + this.index).className = "tool tool-max"; this.setStyle(this.lastWidth2, this.lastHeight2); $(this.frame.id).style.left = this.left + "px"; $(this.frame.id).style.top = this.top + "px" } Utils.event.cancelEventBubble(Utils.event.getEvent()) }, __reflash: function () { this.loadData(this.data); Utils.event.cancelEventBubble(Utils.event.getEvent()) }, setStyle: function (b, a) { var c = { width: b, height: a }; this.__calcShape(c); $(this.frame.id).style.width = this.width + "px"; this.__setcontainerstyle(); this.__setproxystyle() }, loadData: function () { if (this.mode == "iframe") { var b = document.createElement("iframe"); b.setAttribute("frameBorder", "0"); b.setAttribute("src", this.url); b.setAttribute("width", "100%"); b.setAttribute("height", "100%"); if ($.Browse.isIE()) { var e = document.createElement("img"); e.src = this.imagePath + "shared/blue-loading.gif"; $(this.container.id).appendChild(e); b.style.display = "none"; b.onreadystatechange = function () { if (this.readyState == "complete") { this.style.display = "block"; e.style.display = "none" } } } $(this.container.id).appendChild(b); return } var c = arguments[0]; if (c) { if (typeof c == "string") { $(this.container.id).innerHTML = c } else { for (var a = 0; a < c.length; a++) { var d = document.createElement("div"); d.id = this.container.id + "_" + this.itemCount; $(this.container.id).appendChild(d); if (c[a].__render && c[a].__bindEvent) { c[a].__render(d.id); c[a].__bindEvent() } else { c[a].style.display = "block"; d.appendChild(c[a]) } this.__resetContainer(); this.itemCount++ } } } }, __moveframe: function () { var a = Utils.event.getEvent(); this.left = a.clientX - this.iDiffX; this.top = a.clientY - this.iDiffY; if (this.left > 0 && this.left < document.documentElement.scrollWidth - this.width) { $(this.rzproxy.id).style.left = this.left + "px" } if (this.top > 0) { $(this.rzproxy.id).style.top = this.top + "px" } }, __downframe: function () { var a = Utils.event.getEvent(); this.iDiffX = a.clientX - $(this.frame.id).offsetLeft; this.iDiffY = a.clientY - $(this.frame.id).offsetTop; $(this.frame.id).style.display = "none"; $(this.rzproxy.id).style.display = "block"; $(this.rzproxy.id).style.width = this.width + "px"; $(this.rzproxy.id).style.height = this.height + "px"; $(this.rzproxy.id).style.left = this.left + "px"; $(this.rzproxy.id).style.top = this.top + "px"; Utils.event.addEventHandler(document, "mousemove", this.move2); Utils.event.addEventHandler(document, "mouseup", this.up2) }, __upframe: function () { $(this.frame.id).style.display = "block"; if (this.left > 0 && this.left < document.documentElement.scrollWidth - this.width) { $(this.frame.id).style.left = this.left + "px" } if (this.top > 0) { $(this.frame.id).style.top = this.top + "px" } $(this.rzproxy.id).style.display = "none"; Utils.event.removeEventHandler(document, "mousemove", this.move2); Utils.event.removeEventHandler(document, "mouseup", this.up2) }, __moverzproxy: function () { var a = Utils.event.getEvent(); this.cWidth = a.clientX - Utils.getOffset($(this.frame.id), "left"); this.cHeight = a.clientY - Utils.getOffset($(this.frame.id), "top"); if (this.cWidth > this.maxWidth) { this.width = this.cWidth; $(this.rzproxy.id).style.width = this.width + "px" } if (this.cHeight > this.maxHeight) { this.height = this.cHeight; $(this.rzproxy.id).style.height = this.height + "px" } }, __downrzproxy: function () { this.__setproxystyle(); this.lastWidth = $(this.rzproxy.id).style.width; this.lastHeight = $(this.rzproxy.id).style.height; $(this.rzproxy.id).style.display = "block"; Utils.event.addEventHandler(document, "mousemove", this.move); Utils.event.addEventHandler(document, "mouseup", this.up) }, __uprzproxy: function () { this.__resetrzproxy(); $(this.rzproxy.id).style.display = "none"; Utils.event.removeEventHandler(document, "mousemove", this.move); Utils.event.removeEventHandler(document, "mouseup", this.up) }, __resetrzproxy: function () { var b = Utils.getPixel($(this.rzproxy.id).style.width) - Utils.getPixel(this.lastWidth); var a = Utils.getPixel($(this.rzproxy.id).style.height) - Utils.getPixel(this.lastHeight); if (Utils.getPixel($(this.rzproxy.id).style.width) > this.maxWidth) { $(this.frame.id).style.width = (Utils.getPixel($(this.frame.id).style.width) + b) + "px"; $(this.container.id).style.width = (Utils.getPixel($(this.container.id).style.width) + b) + "px" } if (Utils.getPixel($(this.rzproxy.id).style.height) > this.maxHeight) { $(this.container.id).style.height = (Utils.getPixel($(this.container.id).style.height) + a) + "px" } }, __getproxyHTML: function () { this.rzproxy.id = "rzproxy_" + this.index; this.rzproxy.className = "panel_resizable_proxy"; this.rzproxy.style.cssText = "z-index: 9007; visibility: visible; display: none;"; return Utils.getDomHtml(this.rzproxy) }, __getcontainerHTML: function () { this.container.id = "container_" + this.index; this.container.className = "panel_frame_body"; return Utils.getDomHtml(this.container) }, __getframeHTML: function () { this.frame.id = "frame_" + this.index; this.frame.className = "panel_frame"; this.frame.style.cssText = ("position: absolute; z-index: 9003; visibility: visible; left: 0px; top: 0px; width: {0}px; display: block;").format(this.width); var a = new StringBuffer(); a.append(("<div id='{0}' onselectstart='return false;' class='panel_frame_head'").format("window_move" + this.index)); if (this.isdragable) { a.append(" style='cursor:move;'>") } else { a.append(" style='cursor:default;'>") } if (this.img) { a.append(("<div style='float:left; margin-right:10px;'><img src='{0}' /></div>").format(this.img)) } if (this.isshowclose) { a.append(("<div class='tool tool-close' id='{0}'>&nbsp;</div>").format("tool_close_" + this.index)) } if (this.ismaxable) { a.append(("<div class='tool tool-max' id='{0}'>&nbsp;</div>").format("tool_max_" + this.index)) } if (this.isreflashable) { a.append(("<div class='tool tool-reflash' id='{0}'>&nbsp;</div>").format("tool_reflash_" + this.index)) } a.append(("<span>{0}</span>").format(this.title)); a.append("</div>"); a.append(this.__getcontainerHTML()); if (this.isresizeable) { a.append(("<div  class='se_resize' id='{0}'></div>").format("resize_southeast_" + this.index)) } this.frame.innerHTML = a.toString(); a.clear(); return Utils.getDomHtml(this.frame) }, __bindEvent: function () { if (this.isshowclose) { Utils.event.addEventHandler($("#tool_close_" + this.index), "mousedown", (function (a) { return function () { Utils.event.cancelEventBubble(Utils.event.getEvent()); if (a.onclose) { a.onclose() } else { a.close() } } })(this)) } if (this.ismaxable) { Utils.event.addEventHandler($("#tool_max_" + this.index), "mousedown", (function (a) { return function () { a.__max() } })(this)) } if (this.isreflashable) { Utils.event.addEventHandler($("#tool_reflash_" + this.index), "mousedown", (function (a) { return function () { a.__reflash() } })(this)) } if (this.isresizeable) { this.move = (function (a) { return function () { a.__moverzproxy() } })(this); this.up = (function (a) { return function () { a.__uprzproxy() } })(this); this.down = (function (a) { return function () { a.__downrzproxy() } })(this); Utils.event.addEventHandler($("#resize_southeast_" + this.index), "mousedown", this.down) } if (this.isdragable) { this.move2 = (function (a) { return function () { a.__moveframe() } })(this); this.up2 = (function (a) { return function () { a.__upframe() } })(this); this.down2 = (function (a) { return function () { a.__downframe() } })(this); Utils.event.addEventHandler($("#window_move" + this.index), "mousedown", this.down2) } }, __setframestyle: function () { if (!this.left) { this.left = (document.body.offsetWidth - $(this.frame.id).offsetWidth) / 2 } if (!this.top) { this.top = (document.documentElement.scrollTop * 2 + document.documentElement.clientHeight - $(this.frame.id).offsetHeight) / 2 } $(this.frame.id).style.left = this.left + "px"; $(this.frame.id).style.top = this.top + "px" }, __setproxystyle: function () { if ($(this.rzproxy.id)) { $(this.rzproxy.id).style.width = $(this.frame.id).offsetWidth + "px"; $(this.rzproxy.id).style.height = $(this.frame.id).offsetHeight + "px"; $(this.rzproxy.id).style.left = $(this.frame.id).style.left; $(this.rzproxy.id).style.top = $(this.frame.id).style.top } }, __setcontainerstyle: function () { var b, a; if ($(this.container.id).currentStyle) { b = Utils.getPixel($(this.container.id).currentStyle.paddingLeft); a = Utils.getPixel($(this.container.id).currentStyle.paddingRight) } if (document.defaultView) { b = Utils.getPixel(document.defaultView.getComputedStyle($(this.container.id), null).paddingLeft); a = Utils.getPixel(document.defaultView.getComputedStyle($(this.container.id), null).paddingRight) } var c = "width: {0}px; height: {1}px;"; $(this.container.id).style.cssText = (c).format(this.width - b - a, this.height) }, __calcShape: function (b) { var d = b.width; var a = b.height; var c = document.body; d = "" + d; a = "" + a; if (d.indexOf("%") > 0) { d = c.offsetWidth * parseInt(d.slice(0, d.indexOf("%"))) / 100 } if (a.indexOf("%") > 0) { a = c.offsetHeight * parseInt(a.slice(0, a.indexOf("%"))) / 100 } this.width = d; this.height = a }, __resetContainer: function () { var a = $(this.container.id + "_" + this.itemCount).offsetTop; if (!this.isscroll) { if (a > Utils.getPixel($(this.container.id).style.height)) { $(this.container.id).style.height = a + "px" } } else { if (a > Utils.getPixel($(this.container.id).style.height)) { $(this.container.id).style.overflow = "scroll" } } }, getData: function () { return this.data } }; Wind.UI.Datalist2 = function () { var a = arguments[0] || {}; this.lockheaders = a.lockheaders; this.unlockheaders = a.unlockheaders; this.renderTo = a.renderTo; this.width = "100%"; this.height = this.__formatWHCssText(a.height); this.onclickEvent = a.click; this.ondblclickEvent = a.dblclick; this.onclickHeaderEvent = a.clickHeader; this.sortedHandler = a.sortedHandler; this.isClickSelect = a.isClickSelect == undefined || a.isClickSelect; this.isMouseoverSelect = a.isMouseoverSelect == undefined || a.isMouseoverSelect; this.pageSetting = a.pageSetting; this.imagePath = a.imagePath; this.isEnableAlternating = a.isEnableAlternating == undefined || a.isEnableAlternating; this.lockWidth = this.__formatWHCssText(a.lockWidth); this.unlockWidth = this.__formatWHCssText(a.unlockWidth); this.emptyText = a.emptyText || "无数据!"; this.isShowHeader = a.isShowHeader == undefined || a.isShowHeader; this.leftHead = this.renderTo + "_lockheaders"; this.rightHead = this.renderTo + "_unlockheaders"; this.leftBody = this.renderTo + "_lockbody"; this.rightBody = this.renderTo + "_unlockbody"; this.left = this.renderTo + "_left"; this.lockheaderstable = this.renderTo + "_lockheaderstable"; this.unlockheaderstable = this.renderTo + "_unlockheaderstable"; this.normalheaderstable = this.renderTo + "_normalheaderstable"; this.lockheadersbody = this.renderTo + "_lockheadersbody"; this.unlockheadersbody = this.renderTo + "_unlockheadersbody"; this.normalheadersbody = this.renderTo + "_normalheadersbody"; this.topright = this.renderTo + "_topright"; this.lockHeadersInfo = []; this.unlockHeadersInfo = []; this.normalHeadersInfo = []; if (this.lockheaders) { if (!this.__isMultiHeaders(this.lockheaders)) { this.__resetHeaders(this.lockheaders); this.lockheaders = [this.lockheaders] } } if (this.unlockheaders) { if (!this.__isMultiHeaders(this.unlockheaders)) { this.__resetHeaders(this.unlockheaders); this.unlockheaders = [this.unlockheaders] } } }; Wind.UI.Datalist2.prototype = { DataBind: function (b, a) { this.trs1 = []; this.trs2 = []; this.currentRowIndex = -1; this.dataSource = b; if (this.isFirstLoad == undefined) { this.isFirstLoad = true } else { this.isFirstLoad = false } this.__render(a); this.__bindEvent() }, appendData: function (d) { var e = this.dataSource.length; this.dataSource = this.dataSource.concat(d); if (this.dataSource && this.dataSource.length) { var c = document.createDocumentFragment(); var b = document.createDocumentFragment(); for (var a = e; a < this.dataSource.length; a++) { if (this.lockHeadersInfo && this.lockHeadersInfo.length) { c.appendChild(this.__renderBodys2("lock", this.tb1, a + 1)) } if (this.unlockHeadersInfo && this.unlockHeadersInfo.length) { b.appendChild(this.__renderBodys2("unlock", this.tb2, a + 1)) } } if (this.lockHeadersInfo && this.lockHeadersInfo.length) { this.tb1.tBodies[0].appendChild(c) } if (this.unlockHeadersInfo && this.unlockHeadersInfo.length) { this.tb2.tBodies[0].appendChild(b) } this.__setStyle2() } }, __render: function (d) { if (this.renderTo) { if (this.isFirstLoad) { $(this.renderTo).style.cssText = ("border:solid 2px #99BBE8;  height:{0}; overflow:hidden; position:relative;").format(this.height) + $(this.renderTo).style.cssText; var c = new StringBuffer(); c.append(("<div style='width:{0};'>").format(this.width)); if (this.lockheaders && this.lockheaders.length) { c.append(("<div id='{0}' style='position:absolute; height:{1}; border-right:solid 2px #99BBE8;z-index:3;'>").format(this.left, this.height)); c.append(("<div id='{0}' style='position:absolute; border-bottom:solid 1px #99BBE8; z-index:3; background-color:white;'></div>").format(this.leftHead)); c.append(("<div id='{0}' style='position:absolute; z-index:2;background-color:white;'></div></div>").format(this.leftBody)) } c.append(("<div id='{0}' style='border-bottom:solid 1px #99BBE8; z-index:2;background-color:white; position:relative;'></div>").format(this.rightHead)); c.append(("<div id='{0}' style='overflow:auto;'></div>").format(this.rightBody)); c.append(("<div id='{0}' style='position:absolute; right:0px; top:0px; width:15px;border-left:solid 1px #ADADAD; border-bottom:solid 1px #99BBE8;'></div>").format(this.topright)); if (this.pageSetting) { c.append(("<div id='{0}' class='PageBox'></div>").format(this.renderTo + "_Foot")) } c.append("</div>"); $(this.renderTo).innerHTML = c.toString(); if (this.lockheaders && this.lockheaders.length) { var e = this.__renderLockHeaders(); if (this.isShowHeader) { $(this.leftHead).appendChild(e) } this.__sortHeaders(this.lockHeadersInfo) } if (this.unlockheaders && this.unlockheaders.length) { var b = this.__renderUnLockHeaders(); if (this.isShowHeader) { $(this.rightHead).appendChild(b) } this.__sortHeaders(this.unlockHeadersInfo) } this.__setStyle1() } if (this.dataSource && this.dataSource.length) { this.tb1 = document.createElement("table"); this.tb1.setAttribute("id", this.lockheadersbody); this.tb1.setAttribute("cellSpacing", 0); this.tb1.className = "tableEllipsis"; this.tb2 = document.createElement("table"); this.tb2.setAttribute("id", this.unlockheadersbody); this.tb2.setAttribute("cellSpacing", 0); this.tb2.className = "tableEllipsis"; for (var a = 0; a < this.dataSource.length; a++) { if (this.lockHeadersInfo && this.lockHeadersInfo.length) { this.__renderBodys("lock", this.tb1, a) } if (this.unlockHeadersInfo && this.unlockHeadersInfo.length) { this.__renderBodys("unlock", this.tb2, a) } } if ($(this.leftBody)) { $(this.leftBody).innerHTML = ""; $(this.leftBody).appendChild(this.tb1) } $(this.rightBody).innerHTML = ""; $(this.rightBody).appendChild(this.tb2); this.__setStyle2() } else { $(this.rightBody).innerHTML = this.emptyText } } if (this.pageSetting) { this.__renderPageBox(d) } }, __setStyle1: function () { if ($(this.left)) { if ($(this.lockheaderstable)) { $(this.lockheaderstable).style.width = this.lockWidth } if ($(this.leftHead)) { $(this.leftBody).style.top = $(this.leftHead).offsetHeight + "px" } $(this.left).style.width = this.lockWidth; if ($(this.rightHead)) { $(this.rightHead).style.width = this.unlockWidth } } else { if ($(this.rightHead)) { $(this.rightHead).style.width = this.width } } if ($(this.unlockheaderstable)) { $(this.topright).style.height = $(this.unlockheaderstable).offsetHeight + "px" } }, __setStyle2: function () { if ($(this.left)) { $(this.lockheadersbody).style.width = this.lockWidth; if ($(this.leftHead)) { this.topScroll = $(this.leftHead).offsetHeight } this.leftScroll = Utils.getPixel(this.lockWidth) + 2; if ($(this.leftHead)) { $(this.leftBody).style.top = $(this.leftHead).offsetHeight } $(this.rightHead).style.left = Utils.getPixel(this.lockWidth) + 2 + "px"; $(this.rightBody).style.width = this.__formatWHCssText($(this.renderTo).offsetWidth - Utils.getPixel(this.lockWidth) - 6); $(this.rightBody).style.marginLeft = Utils.getPixel(this.lockWidth) + 2 + "px" } else { $(this.rightBody).style.width = this.width; this.leftScroll = 0 } if ($(this.left)) { $(this.unlockheadersbody).style.width = this.unlockWidth } else { $(this.unlockheadersbody).style.width = this.width } if (this.height == "100%") { if ($(this.left)) { if (($.Browse.IEVer() == 6) || ($.Browse.IEVer() == 7)) { $(this.rightBody).style.height = ($(this.unlockheadersbody).offsetHeight + 16 + 1) + "px" } } } else { if ($(this.rightHead)) { $(this.rightBody).style.height = ($(this.renderTo).offsetHeight - $(this.rightHead).offsetHeight - 1 - 24 - 3) + "px" } if ($(this.unlockheaderstable)) { $(this.unlockheaderstable).style.width = $(this.unlockheadersbody).offsetWidth + "px" } } if ($(this.rightHead)) { if (this.pageSetting) { $(this.renderTo).style.height = ($(this.rightHead).offsetHeight + $(this.rightBody).offsetHeight + 24) + "px" } else { $(this.renderTo).style.height = ($(this.rightHead).offsetHeight + $(this.rightBody).offsetHeight) + "px" } } }, __bindEvent: function () { Utils.event.addEventHandler($(this.rightBody), "scroll", (function (a) { return function () { var c = a.topScroll - $(a.rightBody).scrollTop; if ($(a.leftBody)) { $(a.leftBody).style.top = c + "px" } var b = a.leftScroll - $(a.rightBody).scrollLeft; $(a.rightHead).style.left = b + "px" } })(this)) }, __renderPageBox: function (a) { this.pageSetting.renderto = this.renderTo + "_Foot"; if (!this.pageBox) { this.pageBox = new Wind.UI.PageBox(this.pageSetting) } this.pageBox.DataBind(a) }, __renderLockHeaders: function () { return this.__renderHeaders("lock") }, __renderUnLockHeaders: function () { return this.__renderHeaders("unlock") }, __renderHeaders: function (f) { var g; var c; var a = document.createElement("table"); if (f == "lock") { g = this.lockheaders; a.setAttribute("id", this.lockheaderstable); c = "L" } if (f == "unlock") { g = this.unlockheaders; a.setAttribute("id", this.unlockheaderstable); c = "R" } a.className = "tableEllipsis"; if (g && g.length) { a.setAttribute("cellSpacing", 0); for (var d = 0; d < g.length; d++) { if (g[d] && g[d].length) { a.insertRow(d); for (var b = 0; b < g[d].length; b++) { a.rows[d].insertCell(b); if (g[d][b]["index"]) { a.rows[d].cells[b].id = f + "_" + g[d][b]["index"] } a.rows[d].cells[b].className = "grid3_hd"; if (g[d][b]["index"]) { a.rows[d].cells[b].setAttribute("index", g[d][b]["index"]) } var e = "font-weight:bold;border-right: 1px solid #C5C5C5;"; if (d > 0) { e += "border-top: 1px solid #C5C5C5;" } if (g[d][b]["width"]) { e += ("width:{0};").format(this.__formatWHCssText(g[d][b]["width"])) } if (g[d][b]["height"]) { e += ("height:{0};").format(this.__formatWHCssText(g[d][b]["height"])) } if (g[d][b]["align"]) { e += ("text-align: {0};").format(g[d][b]["align"]) } if (g[d][b]["sortable"]) { e += "cursor:pointer;"; Utils.event.addEventHandler(a.rows[d].cells[b], "click", (function (m, k, l, j, p, h, n) { return function () { if (m.dataSource && m.dataSource.length) { if (m.onclickHeaderEvent) { var s = []; var q = $(m.renderTo).subTag("td"); if (q && q.length) { for (var o = 0; o < q.length; o++) { if (q[o].getAttribute("index")) { s.push(q[o]) } } } var r = m.__clickHeader(s, p); m.onclickHeaderEvent(n.dataIndex, r) } else { m.__sort(k - 1, l, j, p, h); m.__setRowIndex(); m.currentRowIndex = -1 } } if (m.sortedHandler) { m.sortedHandler() } } })(this, g[d][b]["index"], g[d][b]["type"] ? g[d][b]["type"] : "string", c, a.rows[d].cells[b], g[d][b]["isSortByValue"], g[d][b])); a.rows[d].cells[b].innerHTML = ("<span>{0}</span><img src='data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==' class='grid3_sort_icon'>").format(g[d][b]["header"]) } else { a.rows[d].cells[b].innerHTML = g[d][b]["header"] } if (g[d][b]["style"]) { e += g[d][b]["style"] } a.rows[d].cells[b].style.cssText = e; if (g[d][b]["cs"]) { a.rows[d].cells[b].setAttribute("colSpan", g[d][b]["cs"]) } else { if (g[d][b]["rs"]) { a.rows[d].cells[b].setAttribute("rowSpan", g[d][b]["rs"]) } if (g[d][b]["index"] || (g.length == 1)) { if (f == "lock") { this.lockHeadersInfo.push(g[d][b]) } if (f == "unlock") { this.unlockHeadersInfo.push(g[d][b]) } if (f == "") { this.unlockHeadersInfo.push(g[d][b]) } } } } } } if (!$(this.left)) { a.style.width = this.width } else { if (f == "unlock") { a.style.width = this.unlockWidth } } return a } }, __renderBodys: function (f, g, h) { var e; var d = ""; var a = ""; if (f == "lock") { e = this.lockHeadersInfo } if (f == "unlock") { e = this.unlockHeadersInfo } if (e && e.length) { g.insertRow(h); if (f == "lock") { this.trs1.push(g.rows[h]) } if (f == "unlock") { this.trs2.push(g.rows[h]) } if ((h % 2 == 1) && (this.isEnableAlternating)) { g.rows[h].className = "grid3_row grid3_row_alt" } else { g.rows[h].className = "grid3_row" } g.rows[h].setAttribute("index", h); g.rows[h].setAttribute("rowindex", h); if (this.isMouseoverSelect) { Utils.event.addEventHandler(g.rows[h], "mouseover", (function (j) { return function () { if (j) { j.className += " grid3_row_over" } } })(g.rows[h])); Utils.event.addEventHandler(g.rows[h], "mouseout", (function (j) { return function () { if (j) { j.className = j.className.replace("grid3_row_over", "") } } })(g.rows[h])) } if (this.isClickSelect) { Utils.event.addEventHandler(g.rows[h], "click", (function (k, j) { return function () { var l = parseInt(j.getAttribute("rowindex")); if (k.trs1 && k.trs1.length) { var n = $(k.lockheadersbody).subTag("tr")[k.currentRowIndex]; if (n) { n.className = n.className.replace("grid3_row_selected", "") } $(k.lockheadersbody).subTag("tr")[l].className += " grid3_row_selected" } if (k.trs2 && k.trs2.length) { var m = $(k.unlockheadersbody).subTag("tr")[k.currentRowIndex]; if (m) { m.className = m.className.replace("grid3_row_selected", "") } } $(k.unlockheadersbody).subTag("tr")[l].className += " grid3_row_selected"; k.currentRowIndex = l } })(this, g.rows[h])) } if (this.onclickEvent) { Utils.event.addEventHandler(g.rows[h], "click", (function (l, j, k) { return function () { var m = parseInt(k.getAttribute("index")); var n = parseInt(k.getAttribute("rowindex")); l.onclickEvent(l.dataSource[m], n) } })(this, h, g.rows[h])) } if (this.ondblclickEvent) { Utils.event.addEventHandler(g.rows[h], "dblclick", (function (k, j) { return function () { k.ondblclickEvent(j - 1) } })(this, h)) } var b = 0; for (var c = 0; c < e.length; c++) { a = this.dataSource[h][e[c]["dataIndex"]] || ""; g.rows[h].insertCell(b); if (a.cs) { g.rows[h].cells[b].setAttribute("colSpan", a.cs) } if (a.rs) { g.rows[h].cells[b].setAttribute("rowSpan", a.rs) } g.rows[h].cells[b].className = "grid3_cell"; if (e[c]["width"]) { g.rows[h].cells[b].style.width = this.__formatWHCssText(e[c]["width"]) } if (!e[c]["renderer"]) { if (a.value) { d = a.value } else { d = a } } else { if (a.value) { d = e[c]["renderer"](h, a.value, g.rows[h].cells[b]) } else { d = e[c]["renderer"](h, a, g.rows[h].cells[b]) } } if (d == "") { d = "&nbsp;" } if ((e[c]["width"]) && ($.Browse.IEVer() == 8)) { g.rows[h].cells[b].style.cssText = ("width:{0};").format(this.__formatWHCssText(e[c]["width"])) } if (e[c]["textAlign"]) { g.rows[h].cells[b].align = e[c]["textAlign"] } if (!e[c]["renderer"]) { g.rows[h].cells[b].innerHTML = ("<div class='cell' sortvalue='{0}' {1}>{2}</div>").format(a, d != "&nbsp;" ? ("title='{0}'").format(d) : "", d) } else { g.rows[h].cells[b].innerHTML = ("<div class='cell' sortvalue='{0}' >{1}</div>").format(a, d) } b++ } } }, __renderBodys2: function (f, m, g) { var e = document.createElement("tr"); e.setAttribute("index", g - 1); e.setAttribute("rowindex", g - 1); var d; var l = ""; var h = ""; if (f == "lock") { d = this.lockHeadersInfo } if (f == "unlock") { d = this.unlockHeadersInfo } if (d && d.length) { if (f == "lock") { this.trs1.push(e) } if (f == "unlock") { this.trs2.push(e) } if ((g % 2 == 1) && (this.isEnableAlternating)) { e.className = "grid3_row grid3_row_alt" } else { e.className = "grid3_row" } var b = 0; for (var c = 0; c < d.length; c++) { var a = document.createElement("td"); if (g == 0) { a.style.width = this.__formatWHCssText(d[c]["width"]); a.style.height = "0px"; tb.className = "grid3_cell_first" } else { h = this.dataSource[g - 1][d[c]["dataIndex"]] || ""; if (h.cs) { a.setAttribute("colSpan", h.cs) } if (h.rs) { a.setAttribute("rowSpan", h.rs) } a.className = "grid3_cell"; if (d[c]["width"]) { a.style.width = this.__formatWHCssText(d[c]["width"]) } if (!d[c]["renderer"]) { if (h.value) { l = h.value } else { l = h } } else { if (h.value) { l = d[c]["renderer"](g - 1, h.value, a) } else { l = d[c]["renderer"](g - 1, h, a) } } if (l == "") { l = "&nbsp;" } if ((d[c]["width"]) && ($.Browse.IEVer() == 8)) { a.style.cssText = ("width:{0};").format(this.__formatWHCssText(d[c]["width"])) } if (d[c]["textAlign"]) { a.align = d[c]["textAlign"] } if (!d[c]["renderer"]) { a.innerHTML = ("<div class='cell' sortvalue='{0}' {1}>{2}</div>").format(h, l != "&nbsp;" ? ("title='{0}'").format(l) : "", l) } else { a.innerHTML = ("<div class='cell' sortvalue='{0}'>{1}</div>").format(h, l) } b++ } e.appendChild(a) } } if (this.isMouseoverSelect) { Utils.event.addEventHandler(e, "mouseover", (function (j) { return function () { if (j) { j.className += " grid3_row_over" } } })(e)); Utils.event.addEventHandler(e, "mouseout", (function (j) { return function () { if (j) { j.className = e.className.replace("grid3_row_over", "") } } })(e)) } if (this.isClickSelect) { Utils.event.addEventHandler(e, "click", (function (k, j) { return function () { var n = parseInt(j.getAttribute("rowindex")); if (k.trs1 && k.trs1.length) { var p = $(k.lockheadersbody).subTag("tr")[k.currentRowIndex]; if (p) { p.className = p.className.replace("grid3_row_selected", "") } $(k.lockheadersbody).subTag("tr")[n].className += " grid3_row_selected" } if (k.trs2 && k.trs2.length) { var o = $(k.unlockheadersbody).subTag("tr")[k.currentRowIndex]; if (o) { o.className = o.className.replace("grid3_row_selected", "") } } $(k.unlockheadersbody).subTag("tr")[n].className += " grid3_row_selected"; k.currentRowIndex = n } })(this, e)) } if (this.onclickEvent) { Utils.event.addEventHandler(e, "click", (function (n, j, k) { return function () { var o = parseInt(k.getAttribute("index")); var p = parseInt(k.getAttribute("rowindex")); n.onclickEvent(n.dataSource[o], p) } })(this, g, e)) } if (this.ondblclickEvent) { Utils.event.addEventHandler(e, "dblclick", (function (k, j) { return function () { k.ondblclickEvent(j - 1) } })(this, g)) } return e }, __sortHeaders: function (a) { a.sort(function (d, c) { return d.index - c.index }) }, __sort: function (f, j, l, c, d) { var g = c.className; if (this.lastSortHeaderTD) { if (this.lastSortHeaderTD == c) { if (g.indexOf("sort_asc") > 0) { c.className = "grid3_hd sort_desc" } else { c.className = "grid3_hd sort_asc" } } else { this.lastSortHeaderTD.className = "grid3_hd"; c.className = "grid3_hd sort_asc" } } else { c.className = "grid3_hd sort_asc" } this.lastSortHeaderTD = c; if (this.trs1 && this.trs1.length) { this.trs3 = []; for (var e = 0; e < this.trs1.length; e++) { var h = {}; h.L = this.trs1[e]; h.R = this.trs2[e]; this.trs3.push(h) } this.trs3.sort(this.__getSortFun(f, j, l, c.className, d)); var b = document.createDocumentFragment(); var a = document.createDocumentFragment(); for (var e = 0; e < this.trs3.length; e++) { if (this.isEnableAlternating) { if (e % 2 == 0) { this.trs3[e]["L"].className = "grid3_row"; this.trs3[e]["R"].className = "grid3_row" } else { this.trs3[e]["L"].className = "grid3_row grid3_row_alt"; this.trs3[e]["R"].className = "grid3_row grid3_row_alt" } } b.appendChild(this.trs3[e]["L"]); a.appendChild(this.trs3[e]["R"]) } $(this.lockheadersbody).tBodies[0].appendChild(b); $(this.unlockheadersbody).tBodies[0].appendChild(a) } else { this.trs2.sort(this.__getSortFun(f, j, l, c.className, d)); var k = document.createDocumentFragment(); for (var e = 0; e < this.trs2.length; e++) { if (this.isEnableAlternating) { if (e % 2 == 0) { this.trs2[e].className = "grid3_row" } else { this.trs2[e].className = "grid3_row grid3_row_alt" } } k.appendChild(this.trs2[e]) } $(this.unlockheadersbody).tBodies[0].appendChild(k) } this.sortIndex = f; this.LR = l }, __getSortFun: function (c, d, b, f, a) { var e = function (h, g) { switch (g) { case "int": return parseInt(h); case "float": return parseFloat(h); case "date": return h; default: return h.toString() } }; if (this.trs1 && this.trs1.length) { return function (h, l) { var k, j; if (!a) { k = e(h[b].cells[c].firstChild.firstChild.nodeValue, d); j = e(l[b].cells[c].firstChild.firstChild.nodeValue, d) } else { k = e(h[b].cells[c].firstChild.getAttribute("sortvalue"), d); j = e(l[b].cells[c].firstChild.getAttribute("sortvalue"), d) } var g = 0; if (d == "int" || d == "float") { g = k - j } else { g = k.localeCompare(j) } if (g < 0) { if (f.indexOf("sort_asc") >= 0) { return -1 } else { return 1 } } else { if (g > 0) { if (f.indexOf("sort_asc") >= 0) { return 1 } else { return -1 } } else { return 0 } } } } else { return function (h, l) { var k, j; if (!a) { k = e(h.cells[c].firstChild.firstChild.nodeValue, d); j = e(l.cells[c].firstChild.firstChild.nodeValue, d) } else { k = e(h.cells[c].firstChild.getAttribute("sortvalue"), d); j = e(l.cells[c].firstChild.getAttribute("sortvalue"), d) } var g = 0; if (d == "int" || d == "float") { g = k - j } else { g = k.localeCompare(j) } if (g < 0) { if (f.indexOf("sort_asc") >= 0) { return -1 } else { return 1 } } else { if (g > 0) { if (f.indexOf("sort_asc") >= 0) { return 1 } else { return -1 } } else { return 0 } } } } }, __resetHeaders: function (b) { for (var a = 0; a < b.length; a++) { b[a]["index"] = a + 1 } }, __isMultiHeaders: function (a) { if (a && a.length) { return a[0].length } return false }, __formatWHCssText: function (a) { if (!a) { return "auto" } else { if (!isNaN(a)) { return a + "px" } else { return a } } }, __clickHeader: function (c, d) { var a = "ascending"; if (c.length > 0) { for (var b = 0; b < c.length; b++) { if (c[b] != d) { c[b].className = c[b].className.replace("sort_asc", "").replace("sort_desc", "") } else { if (c[b].className.indexOf("sort_asc") < 0) { c[b].className += "sort_asc"; c[b].className = c[b].className.replace("grid3_hd", "").replace("sort_desc", ""); a = "ascending" } else { c[b].className += "sort_desc"; c[b].className = c[b].className.replace("grid3_hd", "").replace("sort_asc", ""); a = "descending" } } } } return a }, __setRowIndex: function () { if ($(this.left)) { var b = $(this.lockheadersbody).subTag("tr"); if (b && b.length) { for (var c = 0; c < b.length; c++) { b[c].setAttribute("rowindex", c) } } } var a = $(this.unlockheadersbody).subTag("tr"); if (a && a.length) { for (var c = 0; c < a.length; c++) { a[c].setAttribute("rowindex", c) } } } };
